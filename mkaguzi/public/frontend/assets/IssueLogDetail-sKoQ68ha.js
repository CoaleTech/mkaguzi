var w=(S,g,m)=>new Promise((s,k)=>{var x=v=>{try{f(m.next(v))}catch(_){k(_)}},b=v=>{try{f(m.throw(v))}catch(_){k(_)}},f=v=>v.done?s(v.value):Promise.resolve(v.value).then(x,b);f((m=m.apply(S,g)).next())});import{g as R,a as u,c as h,b as T,D as B}from"./index-qIC3Tfxg.js";import{ap as J,ab as K,r as y,Q as W,l as c,p,q as t,s as l,u as n,v as o,A as i,z as d,H as C,F as X,x as Y}from"./vue-DciwFjI_.js";import{aL as Z,aa as E,n as j,aB as ee,ak as te}from"./icons-CtLkBOsu.js";import"./charts-DlPBe6v3.js";import"./utils-Bcd7wHeW.js";const se={class:"p-6"},ae={class:"flex items-center justify-between mb-6"},le={class:"flex items-center gap-4"},oe={class:"text-gray-500 mt-1"},ie={class:"flex items-center gap-2"},ne={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},re={class:"lg:col-span-2 space-y-6"},de={class:"bg-white rounded-lg border p-6"},ue={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ve={class:"mt-1 text-sm text-gray-900"},me={class:"mt-1 text-sm text-gray-900"},ce={class:"mt-1 text-sm text-gray-900"},pe={class:"mt-1 text-sm text-gray-900"},fe={class:"mt-1 text-sm text-gray-900"},ge={class:"bg-white rounded-lg border p-6"},ye={class:"prose max-w-none"},xe={class:"text-gray-700 whitespace-pre-wrap"},be={key:0,class:"bg-white rounded-lg border p-6"},_e={class:"space-y-4"},ke={class:"mt-1 text-sm text-gray-900 whitespace-pre-wrap"},we={class:"mt-1 text-sm text-gray-900"},Ce={class:"mt-1 text-sm text-gray-900"},Re={class:"bg-white rounded-lg border p-6"},Ie={class:"flex items-center justify-between mb-4"},Ve={key:0,class:"text-center py-8 text-gray-500"},De={key:1,class:"space-y-4"},he={class:"flex items-start justify-between"},Se={class:"flex items-center gap-2"},$e={class:"font-medium text-sm text-gray-900"},Le={class:"text-xs text-gray-500"},Ae={class:"mt-2 text-sm text-gray-700 whitespace-pre-wrap"},Me={class:"space-y-6"},Te={class:"bg-white rounded-lg border p-6"},Be={class:"space-y-2"},Ee={class:"bg-white rounded-lg border p-6"},je={class:"space-y-3"},Ne={key:0},Pe={key:1},Ue={key:2},Oe={class:"bg-white rounded-lg border p-6"},qe={class:"space-y-3"},He={class:"flex items-start gap-3"},ze={class:"flex-1"},Fe={class:"text-xs text-gray-500"},Qe={key:0,class:"flex items-start gap-3"},Ge={class:"flex-1"},Je={class:"text-xs text-gray-500"},Ke={class:"space-y-4"},We={class:"space-y-4"},at={__name:"IssueLogDetail",setup(S){const g=J(),m=K(),s=y({}),k=y([]),x=y(!1),b=y(!1),f=y(""),v=y(""),_=y(!1),I=y(!1);W(()=>w(this,null,function*(){yield $(),yield L()}));function $(){return w(this,null,function*(){try{const a=yield R("frappe.client.get",{doctype:"Issue Log",name:g.params.id});s.value=a}catch(a){console.error("Error loading issue:",a)}})}function L(){return w(this,null,function*(){try{const a=yield R("frappe.client.get_list",{doctype:"Comment",filters:{reference_doctype:"Issue Log",reference_name:g.params.id},fields:["name","comment","user","creation"],order_by:"creation desc"});k.value=a}catch(a){console.error("Error loading comments:",a)}})}function N(a){return{Low:"outline",Medium:"secondary",High:"destructive",Critical:"destructive"}[a]||"secondary"}function P(a){return{Open:"secondary","In Progress":"outline",Resolved:"solid",Closed:"outline"}[a]||"secondary"}function U(a){return{Low:"outline",Medium:"secondary",High:"destructive",Urgent:"destructive"}[a]||"secondary"}function V(a){return a?new Date(a).toLocaleDateString():"-"}function D(a){return a?new Date(a).toLocaleString():"-"}function O(){m.push("/inventory-audit/issues")}function A(){m.push(`/inventory-audit/issues/${g.params.id}/edit`)}function M(){s.value.status!=="Resolved"&&(b.value=!0)}function q(){return w(this,null,function*(){I.value=!0;try{yield R("frappe.client.set_value",{doctype:"Issue Log",name:g.params.id,fieldname:{status:"Resolved",resolution:v.value,resolved_by:frappe.session.user,resolved_date:new Date().toISOString().split("T")[0]}}),yield $(),b.value=!1,v.value=""}catch(a){console.error("Error resolving issue:",a)}finally{I.value=!1}})}function H(){return w(this,null,function*(){if(f.value.trim()){_.value=!0;try{yield R("frappe.client.insert",{doc:{doctype:"Comment",reference_doctype:"Issue Log",reference_name:g.params.id,comment:f.value,comment_type:"Comment"}}),yield L(),x.value=!1,f.value=""}catch(a){console.error("Error adding comment:",a)}finally{_.value=!1}}})}function z(){m.push(`/inventory-audit/issues/new?duplicate=${g.params.id}`)}function F(a){m.push(`/inventory-audit/sessions/${a}`)}function Q(a){m.push(`/inventory-audit/variance-cases/${a}`)}function G(a){m.push(`/inventory-audit/plans/${a}`)}return(a,e)=>(p(),c("div",se,[t("div",ae,[t("div",le,[l(o(u),{variant:"ghost",onClick:O},{default:n(()=>[l(o(Z),{class:"w-5 h-5"})]),_:1}),t("div",null,[e[10]||(e[10]=t("h1",{class:"text-2xl font-bold text-gray-900"}," Issue Details ",-1)),t("p",oe,i(s.value.name),1)])]),t("div",ie,[l(o(u),{variant:"outline",onClick:A},{default:n(()=>[l(o(E),{class:"w-4 h-4 mr-2"}),e[11]||(e[11]=d(" Edit Issue ",-1))]),_:1}),l(o(u),{variant:"solid",onClick:M,disabled:s.value.status==="Resolved"},{default:n(()=>[l(o(j),{class:"w-4 h-4 mr-2"}),d(" "+i(s.value.status==="Resolved"?"Resolved":"Mark Resolved"),1)]),_:1},8,["disabled"])])]),t("div",ne,[t("div",re,[t("div",de,[e[20]||(e[20]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Issue Overview",-1)),t("div",ue,[t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700"},"Issue Type",-1)),t("p",ve,i(s.value.issue_type||"-"),1)]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700"},"Severity",-1)),l(o(h),{variant:N(s.value.severity)},{default:n(()=>[d(i(s.value.severity||"Medium"),1)]),_:1},8,["variant"])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700"},"Status",-1)),l(o(h),{variant:P(s.value.status)},{default:n(()=>[d(i(s.value.status||"Open"),1)]),_:1},8,["variant"])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700"},"Priority",-1)),l(o(h),{variant:U(s.value.priority)},{default:n(()=>[d(i(s.value.priority||"Medium"),1)]),_:1},8,["variant"])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700"},"Reported By",-1)),t("p",me,i(s.value.reported_by||"-"),1)]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700"},"Assigned To",-1)),t("p",ce,i(s.value.assigned_to||"-"),1)]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700"},"Reported Date",-1)),t("p",pe,i(V(s.value.reported_date)),1)]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-700"},"Due Date",-1)),t("p",fe,i(V(s.value.due_date)),1)])])]),t("div",ge,[e[21]||(e[21]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Issue Description",-1)),t("div",ye,[t("p",xe,i(s.value.description||"No description provided."),1)])]),s.value.status==="Resolved"?(p(),c("div",be,[e[25]||(e[25]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Resolution Details",-1)),t("div",_e,[t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-gray-700"},"Resolution",-1)),t("p",ke,i(s.value.resolution||"-"),1)]),t("div",null,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-gray-700"},"Resolved By",-1)),t("p",we,i(s.value.resolved_by||"-"),1)]),t("div",null,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-gray-700"},"Resolved Date",-1)),t("p",Ce,i(V(s.value.resolved_date)),1)])])])):C("",!0),t("div",Re,[t("div",Ie,[e[27]||(e[27]=t("h3",{class:"text-lg font-semibold text-gray-900"},"Comments",-1)),l(o(u),{variant:"outline",size:"sm",onClick:e[0]||(e[0]=r=>x.value=!0)},{default:n(()=>[l(o(ee),{class:"w-4 h-4 mr-2"}),e[26]||(e[26]=d(" Add Comment ",-1))]),_:1})]),k.value.length===0?(p(),c("div",Ve," No comments yet. ")):(p(),c("div",De,[(p(!0),c(X,null,Y(k.value,r=>(p(),c("div",{key:r.name,class:"border-l-4 border-blue-500 pl-4"},[t("div",he,[t("div",Se,[t("span",$e,i(r.user),1),t("span",Le,i(D(r.creation)),1)])]),t("p",Ae,i(r.comment),1)]))),128))]))])]),t("div",Me,[t("div",Te,[e[30]||(e[30]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Quick Actions",-1)),t("div",Be,[l(o(u),{variant:"outline",class:"w-full justify-start",onClick:A},{default:n(()=>[l(o(E),{class:"w-4 h-4 mr-2"}),e[28]||(e[28]=d(" Edit Issue ",-1))]),_:1}),l(o(u),{variant:"outline",class:"w-full justify-start",onClick:M,disabled:s.value.status==="Resolved"},{default:n(()=>[l(o(j),{class:"w-4 h-4 mr-2"}),d(" "+i(s.value.status==="Resolved"?"Already Resolved":"Mark Resolved"),1)]),_:1},8,["disabled"]),l(o(u),{variant:"outline",class:"w-full justify-start",onClick:z},{default:n(()=>[l(o(te),{class:"w-4 h-4 mr-2"}),e[29]||(e[29]=d(" Duplicate Issue ",-1))]),_:1})])]),t("div",Ee,[e[34]||(e[34]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Related Records",-1)),t("div",je,[s.value.stock_take_session?(p(),c("div",Ne,[e[31]||(e[31]=t("label",{class:"block text-sm font-medium text-gray-700"},"Stock Take Session",-1)),l(o(u),{variant:"link",class:"p-0 h-auto text-blue-600 hover:text-blue-800",onClick:e[1]||(e[1]=r=>F(s.value.stock_take_session))},{default:n(()=>[d(i(s.value.session_name||s.value.stock_take_session),1)]),_:1})])):C("",!0),s.value.variance_case?(p(),c("div",Pe,[e[32]||(e[32]=t("label",{class:"block text-sm font-medium text-gray-700"},"Variance Case",-1)),l(o(u),{variant:"link",class:"p-0 h-auto text-blue-600 hover:text-blue-800",onClick:e[2]||(e[2]=r=>Q(s.value.variance_case))},{default:n(()=>[d(i(s.value.case_name||s.value.variance_case),1)]),_:1})])):C("",!0),s.value.audit_plan?(p(),c("div",Ue,[e[33]||(e[33]=t("label",{class:"block text-sm font-medium text-gray-700"},"Audit Plan",-1)),l(o(u),{variant:"link",class:"p-0 h-auto text-blue-600 hover:text-blue-800",onClick:e[3]||(e[3]=r=>G(s.value.audit_plan))},{default:n(()=>[d(i(s.value.plan_name||s.value.audit_plan),1)]),_:1})])):C("",!0)])]),t("div",Oe,[e[39]||(e[39]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Timeline",-1)),t("div",qe,[t("div",He,[e[36]||(e[36]=t("div",{class:"w-2 h-2 bg-blue-500 rounded-full mt-2"},null,-1)),t("div",ze,[e[35]||(e[35]=t("p",{class:"text-sm font-medium text-gray-900"},"Issue Created",-1)),t("p",Fe,i(D(s.value.creation)),1)])]),s.value.status==="Resolved"?(p(),c("div",Qe,[e[38]||(e[38]=t("div",{class:"w-2 h-2 bg-green-500 rounded-full mt-2"},null,-1)),t("div",Ge,[e[37]||(e[37]=t("p",{class:"text-sm font-medium text-gray-900"},"Issue Resolved",-1)),t("p",Je,i(D(s.value.resolved_date)),1)])])):C("",!0)])])])]),l(o(B),{modelValue:x.value,"onUpdate:modelValue":e[6]||(e[6]=r=>x.value=r),options:{title:"Add Comment"}},{"body-content":n(()=>[t("div",Ke,[l(o(T),{type:"textarea",modelValue:f.value,"onUpdate:modelValue":e[4]||(e[4]=r=>f.value=r),placeholder:"Enter your comment...",rows:4},null,8,["modelValue"])])]),actions:n(()=>[l(o(u),{variant:"outline",onClick:e[5]||(e[5]=r=>x.value=!1)},{default:n(()=>[...e[40]||(e[40]=[d("Cancel",-1)])]),_:1}),l(o(u),{variant:"solid",onClick:H,loading:_.value},{default:n(()=>[...e[41]||(e[41]=[d(" Add Comment ",-1)])]),_:1},8,["loading"])]),_:1},8,["modelValue"]),l(o(B),{modelValue:b.value,"onUpdate:modelValue":e[9]||(e[9]=r=>b.value=r),options:{title:"Resolve Issue"}},{"body-content":n(()=>[t("div",We,[l(o(T),{type:"textarea",modelValue:v.value,"onUpdate:modelValue":e[7]||(e[7]=r=>v.value=r),placeholder:"Describe how this issue was resolved...",rows:4,label:"Resolution Details"},null,8,["modelValue"])])]),actions:n(()=>[l(o(u),{variant:"outline",onClick:e[8]||(e[8]=r=>b.value=!1)},{default:n(()=>[...e[42]||(e[42]=[d("Cancel",-1)])]),_:1}),l(o(u),{variant:"solid",onClick:q,loading:I.value},{default:n(()=>[...e[43]||(e[43]=[d(" Resolve Issue ",-1)])]),_:1},8,["loading"])]),_:1},8,["modelValue"])]))}};export{at as default};
//# sourceMappingURL=IssueLogDetail-sKoQ68ha.js.map
