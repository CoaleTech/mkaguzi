var Z=Object.defineProperty;var U=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var I=(g,i,d)=>i in g?Z(g,i,{enumerable:!0,configurable:!0,writable:!0,value:d}):g[i]=d,A=(g,i)=>{for(var d in i||(i={}))G.call(i,d)&&I(g,d,i[d]);if(U)for(var d of U(i))J.call(i,d)&&I(g,d,i[d]);return g};var v=(g,i,d)=>new Promise((b,w)=>{var S=u=>{try{x(d.next(u))}catch(p){w(p)}},V=u=>{try{x(d.throw(u))}catch(p){w(p)}},x=u=>u.done?b(u.value):Promise.resolve(u.value).then(S,V);x((d=d.apply(g,i)).next())});import{g as f,a as y,b as r,D as M}from"./index-qIC3Tfxg.js";import{ap as H,ab as Q,r as h,j as K,Q as X,w as Y,l as P,p as q,q as t,s as o,u as m,v as a,A as C,z as c,H as ee}from"./vue-DciwFjI_.js";import{_ as se}from"./PhysicalCountTable-B26Ly8gS.js";import{aL as te,ad as T,a0 as le,N as ae}from"./icons-CtLkBOsu.js";import"./charts-DlPBe6v3.js";import"./utils-Bcd7wHeW.js";const oe={class:"p-6"},ne={class:"flex items-center justify-between mb-6"},ie={class:"flex items-center gap-4"},de={class:"text-2xl font-bold text-gray-900"},ue={class:"text-gray-500 mt-1"},re={class:"flex items-center gap-2"},me={class:"max-w-4xl"},pe={class:"space-y-6"},ve={class:"bg-white rounded-lg border p-6"},ce={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ge={class:"md:col-span-2"},fe={class:"bg-white rounded-lg border p-6"},ye={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},be={class:"bg-white rounded-lg border p-6"},_e={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},he={class:"bg-white rounded-lg border p-6"},xe={class:"flex items-center justify-between mb-4"},we={class:"flex items-center gap-2"},Se={class:"bg-white rounded-lg border p-6"},Ve={class:"flex items-center justify-end gap-3 mt-6 pt-6 border-t"},Ce={class:"space-y-4"},ke={key:0,class:"p-4 bg-gray-50 rounded-lg"},$e={__name:"StockTakeSessionForm",setup(g){const i=H(),d=Q(),b=h(!1),w=h([]),S=h([]),V=h([]),x=h([]),u=h(!1),p=h(""),_=K(()=>i.params.id&&i.params.id!=="new"),l=h({session_name:"",session_type:"Cycle Count",status:"Scheduled",audit_plan:"",scheduled_date:new Date().toISOString().split("T")[0],warehouse:"",zone:"",bin_location:"",assigned_counters:"",supervisor:"",count_items:[],notes:""});X(()=>v(this,null,function*(){yield Promise.all([$(),N(),z(),L()]),_.value&&(yield B())})),Y(()=>l.value.audit_plan,s=>v(this,null,function*(){if(s&&!_.value)try{const e=yield f("frappe.client.get_value",{doctype:"Inventory Audit Plan",filters:{name:s},fieldname:["warehouse"]});e.warehouse&&(l.value.warehouse=e.warehouse)}catch(e){console.error("Error loading plan details:",e)}}));function $(){return v(this,null,function*(){try{const s=yield f("frappe.client.get_list",{doctype:"User",filters:{enabled:1,user_type:"System User"},fields:["name","full_name"],limit_page_length:0});w.value=s.map(e=>({label:e.full_name||e.name,value:e.name}))}catch(s){console.error("Error loading users:",s)}})}function N(){return v(this,null,function*(){try{const s=yield f("frappe.client.get_list",{doctype:"Inventory Audit Plan",filters:{status:["in",["Planned","In Progress"]]},fields:["name","plan_title"],limit_page_length:0});S.value=s.map(e=>({label:e.plan_title||e.name,value:e.name}))}catch(s){console.error("Error loading audit plans:",s)}})}function z(){return v(this,null,function*(){try{const s=yield f("frappe.client.get_list",{doctype:"Warehouse",fields:["name","warehouse_name"],limit_page_length:0});V.value=s.map(e=>({label:e.warehouse_name||e.name,value:e.name}))}catch(s){console.error("Error loading warehouses:",s)}})}function L(){return v(this,null,function*(){try{const s=yield f("frappe.client.get_list",{doctype:"Inventory Snapshot",filters:{status:"Active"},fields:["name","snapshot_date","warehouse"],limit_page_length:50,order_by:"snapshot_date desc"});x.value=s.map(e=>({label:`${e.name} - ${e.warehouse} (${e.snapshot_date})`,value:e.name}))}catch(s){console.error("Error loading snapshots:",s)}})}function B(){return v(this,null,function*(){try{const s=yield f("frappe.client.get",{doctype:"Stock Take Session",name:i.params.id});l.value={session_name:s.session_name||"",session_type:s.session_type||"Cycle Count",status:s.status||"Scheduled",audit_plan:s.audit_plan||"",scheduled_date:s.scheduled_date||"",warehouse:s.warehouse||"",zone:s.zone||"",bin_location:s.bin_location||"",assigned_counters:s.assigned_counters||"",supervisor:s.supervisor||"",count_items:s.count_items||[],notes:s.notes||""}}catch(s){console.error("Error loading session:",s)}})}function E(){return v(this,null,function*(){if(!l.value.session_type){alert("Session type is required");return}if(!l.value.scheduled_date){alert("Scheduled date is required");return}b.value=!0;try{if(_.value)yield f("frappe.client.set_value",{doctype:"Stock Take Session",name:i.params.id,fieldname:l.value}),d.push(`/inventory-audit/sessions/${i.params.id}`);else{const s=yield f("frappe.client.insert",{doc:A({doctype:"Stock Take Session"},l.value)});d.push(`/inventory-audit/sessions/${s.name}`)}}catch(s){console.error("Error saving session:",s),alert("Error saving session: "+s.message)}finally{b.value=!1}})}function D(){return v(this,null,function*(){if(!l.value.session_type||!l.value.scheduled_date){alert("Session type and scheduled date are required");return}b.value=!0;try{yield f("frappe.client.insert",{doc:A({doctype:"Stock Take Session"},l.value)}),l.value={session_name:"",session_type:"Cycle Count",status:"Scheduled",audit_plan:l.value.audit_plan,scheduled_date:l.value.scheduled_date,warehouse:l.value.warehouse,zone:"",bin_location:"",assigned_counters:"",supervisor:"",count_items:[],notes:""}}catch(s){console.error("Error saving session:",s),alert("Error saving session: "+s.message)}finally{b.value=!1}})}function O(){l.value.count_items.push({item_code:"",item_name:"",system_qty:0,counted_qty:null,variance_qty:0,variance_value:0,uom:"Nos",condition:"Good",notes:""})}function j(){u.value=!0}function F(){return v(this,null,function*(){if(p.value)try{const s=yield f("frappe.client.get",{doctype:"Inventory Snapshot",name:p.value});s.items&&s.items.length>0&&(l.value.count_items=s.items.map(e=>({item_code:e.item_code,item_name:e.item_name,system_qty:e.qty||0,counted_qty:null,variance_qty:0,variance_value:0,uom:e.uom||"Nos",condition:"Good",notes:""}))),s.warehouse&&(l.value.warehouse=s.warehouse),u.value=!1,p.value=""}catch(s){console.error("Error loading snapshot:",s),alert("Error loading snapshot: "+s.message)}})}function k(){_.value?d.push(`/inventory-audit/sessions/${i.params.id}`):d.push("/inventory-audit/sessions")}const R=[{label:"Cycle Count",value:"Cycle Count"},{label:"Full Count",value:"Full Count"},{label:"Spot Check",value:"Spot Check"},{label:"Blind Count",value:"Blind Count"},{label:"Verification",value:"Verification"}],W=[{label:"Scheduled",value:"Scheduled"},{label:"In Progress",value:"In Progress"},{label:"Pending Review",value:"Pending Review"},{label:"Completed",value:"Completed"},{label:"Cancelled",value:"Cancelled"}];return(s,e)=>(q(),P("div",oe,[t("div",ne,[t("div",ie,[o(a(y),{variant:"ghost",onClick:k},{default:m(()=>[o(a(te),{class:"w-5 h-5"})]),_:1}),t("div",null,[t("h1",de,C(_.value?"Edit Session":"New Stock Take Session"),1),t("p",ue,C(_.value?`Editing ${a(i).params.id}`:"Create a new stock take session"),1)])]),t("div",re,[o(a(y),{variant:"outline",onClick:k},{default:m(()=>[...e[15]||(e[15]=[c("Cancel",-1)])]),_:1}),o(a(y),{variant:"solid",onClick:E,loading:b.value},{default:m(()=>[o(a(T),{class:"w-4 h-4 mr-2"}),c(" "+C(_.value?"Save Changes":"Create Session"),1)]),_:1},8,["loading"])])]),t("div",me,[t("div",pe,[t("div",ve,[e[21]||(e[21]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Basic Information",-1)),t("div",ce,[t("div",ge,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Session Name ",-1)),o(a(r),{type:"text",modelValue:l.value.session_name,"onUpdate:modelValue":e[0]||(e[0]=n=>l.value.session_name=n),placeholder:"e.g., Zone A Cycle Count - Week 48"},null,8,["modelValue"])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[c(" Session Type "),t("span",{class:"text-red-500"},"*")],-1)),o(a(r),{type:"select",modelValue:l.value.session_type,"onUpdate:modelValue":e[1]||(e[1]=n=>l.value.session_type=n),options:R},null,8,["modelValue"])]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Status",-1)),o(a(r),{type:"select",modelValue:l.value.status,"onUpdate:modelValue":e[2]||(e[2]=n=>l.value.status=n),options:W},null,8,["modelValue"])]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Linked Audit Plan ",-1)),o(a(r),{type:"autocomplete",modelValue:l.value.audit_plan,"onUpdate:modelValue":e[3]||(e[3]=n=>l.value.audit_plan=n),options:S.value,placeholder:"Select audit plan"},null,8,["modelValue","options"])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[c(" Scheduled Date "),t("span",{class:"text-red-500"},"*")],-1)),o(a(r),{type:"date",modelValue:l.value.scheduled_date,"onUpdate:modelValue":e[4]||(e[4]=n=>l.value.scheduled_date=n)},null,8,["modelValue"])])])]),t("div",fe,[e[25]||(e[25]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Location",-1)),t("div",ye,[t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Warehouse",-1)),o(a(r),{type:"autocomplete",modelValue:l.value.warehouse,"onUpdate:modelValue":e[5]||(e[5]=n=>l.value.warehouse=n),options:V.value,placeholder:"Select warehouse"},null,8,["modelValue","options"])]),t("div",null,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Zone",-1)),o(a(r),{type:"text",modelValue:l.value.zone,"onUpdate:modelValue":e[6]||(e[6]=n=>l.value.zone=n),placeholder:"e.g., Zone A"},null,8,["modelValue"])]),t("div",null,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Bin Location",-1)),o(a(r),{type:"text",modelValue:l.value.bin_location,"onUpdate:modelValue":e[7]||(e[7]=n=>l.value.bin_location=n),placeholder:"e.g., A-01-01"},null,8,["modelValue"])])])]),t("div",be,[e[29]||(e[29]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Assignment",-1)),t("div",_e,[t("div",null,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Assigned Counters",-1)),o(a(r),{type:"text",modelValue:l.value.assigned_counters,"onUpdate:modelValue":e[8]||(e[8]=n=>l.value.assigned_counters=n),placeholder:"e.g., John Doe, Jane Smith"},null,8,["modelValue"]),e[27]||(e[27]=t("p",{class:"text-xs text-gray-500 mt-1"},"Comma-separated list of counter names",-1))]),t("div",null,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Supervisor",-1)),o(a(r),{type:"autocomplete",modelValue:l.value.supervisor,"onUpdate:modelValue":e[9]||(e[9]=n=>l.value.supervisor=n),options:w.value,placeholder:"Select supervisor"},null,8,["modelValue","options"])])])]),t("div",he,[t("div",xe,[e[32]||(e[32]=t("h3",{class:"text-lg font-semibold text-gray-900"},"Items to Count",-1)),t("div",we,[o(a(y),{variant:"outline",size:"sm",onClick:j},{default:m(()=>[o(a(le),{class:"w-4 h-4 mr-2"}),e[30]||(e[30]=c(" Load from Snapshot ",-1))]),_:1}),o(a(y),{variant:"outline",size:"sm",onClick:O},{default:m(()=>[o(a(ae),{class:"w-4 h-4 mr-2"}),e[31]||(e[31]=c(" Add Item ",-1))]),_:1})])]),o(a(se),{modelValue:l.value.count_items,"onUpdate:modelValue":e[10]||(e[10]=n=>l.value.count_items=n),readonly:!1},null,8,["modelValue"])]),t("div",Se,[e[33]||(e[33]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Notes",-1)),o(a(r),{type:"textarea",modelValue:l.value.notes,"onUpdate:modelValue":e[11]||(e[11]=n=>l.value.notes=n),placeholder:"Additional notes or instructions for this session...",rows:4},null,8,["modelValue"])])]),t("div",Ve,[o(a(y),{variant:"outline",onClick:k},{default:m(()=>[...e[34]||(e[34]=[c("Cancel",-1)])]),_:1}),o(a(y),{variant:"outline",onClick:D,loading:b.value},{default:m(()=>[...e[35]||(e[35]=[c(" Save & Add Another ",-1)])]),_:1},8,["loading"]),o(a(y),{variant:"solid",onClick:E,loading:b.value},{default:m(()=>[o(a(T),{class:"w-4 h-4 mr-2"}),c(" "+C(_.value?"Save Changes":"Create Session"),1)]),_:1},8,["loading"])])]),o(a(M),{modelValue:u.value,"onUpdate:modelValue":e[14]||(e[14]=n=>u.value=n),options:{title:"Load Items from Snapshot"}},{"body-content":m(()=>[t("div",Ce,[t("div",null,[e[36]||(e[36]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Select Snapshot",-1)),o(a(r),{type:"autocomplete",modelValue:p.value,"onUpdate:modelValue":e[12]||(e[12]=n=>p.value=n),options:x.value,placeholder:"Search snapshots..."},null,8,["modelValue","options"])]),p.value?(q(),P("div",ke,[...e[37]||(e[37]=[t("p",{class:"text-sm text-gray-600"}," This will load all items from the selected snapshot. Existing items will be replaced. ",-1)])])):ee("",!0)])]),actions:m(()=>[o(a(y),{variant:"outline",onClick:e[13]||(e[13]=n=>u.value=!1)},{default:m(()=>[...e[38]||(e[38]=[c("Cancel",-1)])]),_:1}),o(a(y),{variant:"solid",onClick:F,disabled:!p.value},{default:m(()=>[...e[39]||(e[39]=[c(" Load Items ",-1)])]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]))}};export{$e as default};
//# sourceMappingURL=StockTakeSessionForm-DVGAhGsK.js.map
