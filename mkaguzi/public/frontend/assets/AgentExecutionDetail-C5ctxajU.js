var w=($,S,m)=>new Promise((v,p)=>{var h=_=>{try{y(m.next(_))}catch(f){p(f)}},s=_=>{try{y(m.throw(_))}catch(f){p(f)}},y=_=>_.done?v(_.value):Promise.resolve(_.value).then(h,s);y((m=m.apply($,S)).next())});import{a as te,u as se,Q as ae,r as q,c as P,o as re,B as oe,b as n,d as o,e,g as u,h as g,j as l,A as ne,_ as C,t as a,i as c,l as k,f as d,k as b,R as ie,v as I,U as le,V as de,F as R,p as F,W as ue,q as M,Y as ce,K as ge,x as pe}from"./index-DyBJn5r4.js";const xe={class:"space-y-6"},_e={class:"flex items-center justify-between"},me={class:"flex items-center space-x-3"},ve={class:"text-2xl font-bold text-gray-900"},ye={class:"text-gray-600 mt-1"},fe={class:"flex items-center space-x-3"},be={key:0,class:"flex justify-center items-center py-12"},he={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},ke={class:"bg-white rounded-lg border border-gray-200 p-4"},we={class:"text-xl font-bold text-gray-900"},Ce={class:"bg-white rounded-lg border border-gray-200 p-4"},Se={class:"text-xl font-bold text-gray-900"},Te={class:"bg-white rounded-lg border border-gray-200 p-4"},Re={class:"bg-white rounded-lg border border-gray-200 p-4"},Ee={key:0,class:"bg-white rounded-lg border border-gray-200 p-4"},Pe={class:"flex items-center justify-between mb-2"},Fe={class:"text-sm text-gray-600"},Me={class:"w-full bg-gray-200 rounded-full h-2"},$e={class:"bg-white rounded-lg border border-gray-200"},Ae={class:"border-b border-gray-200"},De={class:"flex -mb-px overflow-x-auto"},Ne=["onClick"],Ve={key:0,class:"ml-1 text-xs bg-gray-100 text-gray-600 px-1.5 py-0.5 rounded-full"},Be={class:"p-6"},Le={key:0,class:"space-y-6"},je={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Oe={class:"space-y-4"},We={class:"grid grid-cols-2 gap-3"},Ue={class:"font-medium text-sm"},qe={class:"font-medium text-sm"},Ie={class:"font-medium text-sm"},Je={class:"font-medium text-sm"},Qe={class:"space-y-4"},ze={class:"grid grid-cols-2 gap-3"},He={class:"font-medium text-sm"},Ke={class:"font-medium text-sm"},Ge={class:"font-medium text-sm"},Xe={class:"font-medium text-sm"},Ye={key:0,class:"space-y-3"},Ze={class:"flex flex-wrap gap-3"},et={key:1,class:"inline-flex items-center px-3 py-2 bg-gray-50 text-gray-700 rounded-lg text-sm"},tt={key:1},st={class:"bg-gray-50 rounded-lg p-4 text-sm text-gray-700 whitespace-pre-wrap"},at={key:1,class:"space-y-4"},rt={key:0},ot={class:"flex items-center space-x-4 mb-4"},nt={class:"text-sm text-green-600 font-medium"},it={class:"text-sm text-red-600 font-medium"},lt={class:"text-sm text-gray-600"},dt={class:"w-full"},ut={class:"px-4 py-2 text-sm text-gray-900"},ct={class:"px-4 py-2"},gt={class:"px-4 py-2"},pt={key:1,class:"text-sm text-gray-400"},xt={class:"px-4 py-2 text-sm text-gray-600"},_t={class:"px-4 py-2"},mt={key:0,class:"text-red-600 text-sm font-medium"},vt={key:1,class:"text-sm text-gray-400"},yt={class:"px-4 py-2 text-sm text-gray-600"},ft={key:1,class:"text-center py-8 text-gray-500"},bt={key:2,class:"space-y-4"},ht={key:0},kt=["onClick"],wt={class:"flex items-start justify-between"},Ct={class:"font-medium text-gray-900"},St={class:"text-sm text-gray-600 mt-1"},Tt={class:"flex items-center space-x-2"},Rt={key:1,class:"text-center py-8 text-gray-500"},Et={key:3,class:"space-y-6"},Pt={key:0},Ft={class:"bg-gray-900 text-green-400 rounded-lg p-4 text-sm overflow-x-auto max-h-96"},Mt={key:1},$t={class:"bg-gray-900 text-green-400 rounded-lg p-4 text-sm overflow-x-auto max-h-96"},At={key:2},Dt={class:"bg-gray-900 text-green-400 rounded-lg p-4 text-sm overflow-x-auto max-h-96"},Nt={key:3,class:"text-center py-8 text-gray-500"},Vt={key:4,class:"space-y-6"},Bt={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},Lt={class:"bg-gray-50 rounded-lg p-4"},jt={class:"text-xl font-bold text-gray-900"},Ot={class:"bg-gray-50 rounded-lg p-4"},Wt={class:"text-xl font-bold text-gray-900"},Ut={class:"bg-gray-50 rounded-lg p-4"},qt={class:"text-xl font-bold text-gray-900"},It={class:"bg-gray-50 rounded-lg p-4"},Jt={class:"text-xl font-bold text-gray-900"},Qt={class:"grid grid-cols-2 gap-4"},zt={class:"bg-gray-50 rounded-lg p-4"},Ht={class:"text-lg font-medium"},Kt={class:"bg-gray-50 rounded-lg p-4"},Gt={class:"text-lg font-medium"},Xt={key:5,class:"space-y-4"},Yt={key:0},Zt={class:"bg-red-50 border border-red-200 rounded-lg p-4 space-y-3"},es={class:"text-sm text-red-700"},ts={class:"text-sm text-red-700"},ss={key:0},as={class:"bg-red-900 text-red-200 rounded p-3 text-xs overflow-x-auto max-h-64"},rs={key:1,class:"text-center py-8 text-gray-500"},os={key:2,class:"text-center py-12"},ls={__name:"AgentExecutionDetail",setup($){const S=te(),m=se(),v=ae(),p=q("overview"),h=q([]),s=P(()=>v.currentExecution),y=P(()=>!s.value||!s.value.total_tests?0:Math.round(s.value.passed_tests/s.value.total_tests*100)),_=P(()=>{var r,t,x;return[{id:"overview",label:"Overview"},{id:"evidence",label:"Test Evidence",count:((t=(r=s.value)==null?void 0:r.test_evidence)==null?void 0:t.length)||0},{id:"findings",label:"Findings",count:h.value.length},{id:"data",label:"Execution Data"},{id:"performance",label:"Performance"},{id:"errors",label:"Errors",count:(x=s.value)!=null&&x.error_occurred?1:0}]}),f=()=>w(this,null,function*(){var t;const r=S.params.id;r&&(yield v.fetchExecutionDetail(r),(t=s.value)!=null&&t.finding_ids&&(yield J()))}),J=()=>w(this,null,function*(){var t;if(!((t=s.value)!=null&&t.finding_ids))return;const r=s.value.finding_ids.split(",").map(x=>x.trim()).filter(Boolean);if(r.length!==0)try{const x=yield pe({url:"frappe.client.get_list",params:{doctype:"Audit Finding",fields:["name","finding_title","finding_category","severity","risk_rating","finding_status"],filters:{name:["in",r]}}}).fetch();h.value=x||[]}catch(x){console.error("Failed to load linked findings:",x)}}),Q=()=>w(this,null,function*(){try{yield v.cancelExecution(S.params.id),yield f()}catch(r){console.error("Cancel failed:",r)}}),z=()=>w(this,null,function*(){if(s.value)try{yield v.executeAgent(s.value.agent_type,{task_type:s.value.task_type}),m.push("/audit-execution/agent-dashboard")}catch(r){console.error("Re-run failed:",r)}}),H=()=>{var r;(r=s.value)!=null&&r.working_paper_reference&&m.push("/audit-execution/working-papers")},K=r=>({Pending:"secondary",Running:"info",Completed:"success",Failed:"danger",Cancelled:"warning",Timeout:"danger"})[r]||"secondary",G=r=>({Financial:"success",Risk:"warning",Compliance:"info",Discovery:"subtle",Notification:"warning"})[r]||"secondary",X=r=>({Low:"secondary",Medium:"info",High:"warning",Critical:"danger"})[r]||"secondary",A=r=>({Critical:"danger",High:"warning",Medium:"info",Low:"secondary"})[r]||"secondary",Y=r=>({Pass:"success",Fail:"danger",Warning:"warning",Error:"danger",Skipped:"secondary"})[r]||"secondary",Z=r=>({Open:"danger","Action in Progress":"warning","Pending Verification":"info",Closed:"success"})[r]||"secondary",D=r=>r?new Date(r).toLocaleString():"-",T=r=>!r||r===0?"-":r<60?`${Math.round(r)}s`:r<3600?`${Math.round(r/60)}m ${Math.round(r%60)}s`:`${Math.floor(r/3600)}h ${Math.round(r%3600/60)}m`,E=r=>{if(!r)return"";try{return JSON.stringify(JSON.parse(r),null,2)}catch(t){return r}};return re(()=>{f()}),(r,t)=>{var N,V,B,L,j,O,W,U;const x=oe("router-link");return o(),n("div",xe,[e("div",_e,[e("div",me,[u(l(C),{variant:"ghost",onClick:t[0]||(t[0]=i=>r.$router.push("/audit-execution/agent-dashboard"))},{default:g(()=>[u(l(ne),{class:"h-4 w-4"})]),_:1}),e("div",null,[e("h1",ve,a(((N=s.value)==null?void 0:N.agent_name)||((V=s.value)==null?void 0:V.agent_type)||"Agent Execution"),1),e("p",ye,[c(a(((B=s.value)==null?void 0:B.task_name)||((L=s.value)==null?void 0:L.task_type)||"Loading...")+" ",1),s.value?(o(),k(l(b),{key:0,variant:K(s.value.status),class:"ml-2"},{default:g(()=>[c(a(s.value.status),1)]),_:1},8,["variant"])):d("",!0)])])]),e("div",fe,[((j=s.value)==null?void 0:j.status)==="Running"?(o(),k(l(C),{key:0,variant:"outline",onClick:Q},{default:g(()=>[u(l(ie),{class:"h-4 w-4 mr-2"}),t[1]||(t[1]=c(" Cancel ",-1))]),_:1})):d("",!0),(O=s.value)!=null&&O.working_paper_reference?(o(),k(l(C),{key:1,variant:"outline",onClick:H},{default:g(()=>[u(l(I),{class:"h-4 w-4 mr-2"}),t[2]||(t[2]=c(" Working Paper ",-1))]),_:1})):d("",!0),((W=s.value)==null?void 0:W.status)==="Completed"||((U=s.value)==null?void 0:U.status)==="Failed"?(o(),k(l(C),{key:2,onClick:z},{default:g(()=>[u(l(le),{class:"h-4 w-4 mr-2"}),t[3]||(t[3]=c(" Re-run ",-1))]),_:1})):d("",!0)])]),l(v).loading?(o(),n("div",be,[u(l(de),{class:"h-8 w-8"})])):s.value?(o(),n(R,{key:1},[e("div",he,[e("div",ke,[t[4]||(t[4]=e("p",{class:"text-sm text-gray-600"},"Duration",-1)),e("p",we,a(T(s.value.duration_seconds)),1)]),e("div",Ce,[t[5]||(t[5]=e("p",{class:"text-sm text-gray-600"},"Records Processed",-1)),e("p",Se,a((s.value.records_processed||0).toLocaleString()),1)]),e("div",Te,[t[6]||(t[6]=e("p",{class:"text-sm text-gray-600"},"Findings Generated",-1)),e("p",{class:F(["text-xl font-bold",s.value.total_findings>0?"text-orange-600":"text-gray-900"])},a(s.value.total_findings||0),3)]),e("div",Re,[t[7]||(t[7]=e("p",{class:"text-sm text-gray-600"},"Test Pass Rate",-1)),e("p",{class:F(["text-xl font-bold",y.value>=80?"text-green-600":y.value>=50?"text-yellow-600":"text-red-600"])},a(s.value.total_tests>0?y.value+"%":"-"),3)])]),s.value.status==="Running"&&s.value.progress_percentage>0?(o(),n("div",Ee,[e("div",Pe,[t[8]||(t[8]=e("span",{class:"text-sm font-medium text-gray-700"},"Progress",-1)),e("span",Fe,a(s.value.progress_percentage)+"%",1)]),e("div",Me,[e("div",{class:"bg-blue-600 h-2 rounded-full transition-all",style:ue({width:s.value.progress_percentage+"%"})},null,4)])])):d("",!0),e("div",$e,[e("div",Ae,[e("nav",De,[(o(!0),n(R,null,M(_.value,i=>(o(),n("button",{key:i.id,onClick:ee=>p.value=i.id,class:F(["px-6 py-3 text-sm font-medium border-b-2 whitespace-nowrap",p.value===i.id?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])},[c(a(i.label)+" ",1),i.count!==void 0?(o(),n("span",Ve,a(i.count),1)):d("",!0)],10,Ne))),128))])]),e("div",Be,[p.value==="overview"?(o(),n("div",Le,[e("div",je,[e("div",Oe,[t[15]||(t[15]=e("h3",{class:"font-semibold text-gray-900"},"Agent Information",-1)),e("div",We,[e("div",null,[t[9]||(t[9]=e("p",{class:"text-sm text-gray-600"},"Agent Type",-1)),u(l(b),{variant:G(s.value.agent_type)},{default:g(()=>[c(a(s.value.agent_type),1)]),_:1},8,["variant"])]),e("div",null,[t[10]||(t[10]=e("p",{class:"text-sm text-gray-600"},"Agent ID",-1)),e("p",Ue,a(s.value.agent_id),1)]),e("div",null,[t[11]||(t[11]=e("p",{class:"text-sm text-gray-600"},"Version",-1)),e("p",qe,a(s.value.agent_version||"1.0.0"),1)]),e("div",null,[t[12]||(t[12]=e("p",{class:"text-sm text-gray-600"},"Execution Mode",-1)),e("p",Ie,a(s.value.execution_mode||"Synchronous"),1)]),e("div",null,[t[13]||(t[13]=e("p",{class:"text-sm text-gray-600"},"Priority",-1)),u(l(b),{variant:X(s.value.priority)},{default:g(()=>[c(a(s.value.priority),1)]),_:1},8,["variant"])]),e("div",null,[t[14]||(t[14]=e("p",{class:"text-sm text-gray-600"},"Triggered By",-1)),e("p",Je,a(s.value.triggered_by||"-"),1)])])]),e("div",Qe,[t[20]||(t[20]=e("h3",{class:"font-semibold text-gray-900"},"Timing",-1)),e("div",ze,[e("div",null,[t[16]||(t[16]=e("p",{class:"text-sm text-gray-600"},"Start Time",-1)),e("p",He,a(D(s.value.start_time)),1)]),e("div",null,[t[17]||(t[17]=e("p",{class:"text-sm text-gray-600"},"End Time",-1)),e("p",Ke,a(D(s.value.end_time)),1)]),e("div",null,[t[18]||(t[18]=e("p",{class:"text-sm text-gray-600"},"Duration",-1)),e("p",Ge,a(T(s.value.duration_seconds)),1)]),e("div",null,[t[19]||(t[19]=e("p",{class:"text-sm text-gray-600"},"Queue Wait",-1)),e("p",Xe,a(T(s.value.queue_wait_seconds)),1)])])])]),s.value.engagement_reference||s.value.working_paper_reference?(o(),n("div",Ye,[t[21]||(t[21]=e("h3",{class:"font-semibold text-gray-900"},"Links",-1)),e("div",Ze,[s.value.engagement_reference?(o(),k(x,{key:0,to:`/engagements/${s.value.engagement_reference}`,class:"inline-flex items-center px-3 py-2 bg-blue-50 text-blue-700 rounded-lg text-sm hover:bg-blue-100"},{default:g(()=>[u(l(ce),{class:"h-4 w-4 mr-2"}),c(" "+a(s.value.engagement_reference),1)]),_:1},8,["to"])):d("",!0),s.value.working_paper_reference?(o(),n("span",et,[u(l(I),{class:"h-4 w-4 mr-2"}),c(" "+a(s.value.working_paper_reference),1)])):d("",!0)])])):d("",!0),s.value.execution_summary?(o(),n("div",tt,[t[22]||(t[22]=e("h3",{class:"font-semibold text-gray-900 mb-2"},"Execution Summary",-1)),e("div",st,a(s.value.execution_summary),1)])):d("",!0)])):d("",!0),p.value==="evidence"?(o(),n("div",at,[s.value.test_evidence&&s.value.test_evidence.length>0?(o(),n("div",rt,[e("div",ot,[e("span",nt,a(s.value.passed_tests)+" Passed",1),e("span",it,a(s.value.failed_tests)+" Failed",1),e("span",lt,a(s.value.total_tests)+" Total",1)]),e("table",dt,[t[23]||(t[23]=e("thead",null,[e("tr",{class:"border-b border-gray-200 bg-gray-50"},[e("th",{class:"text-left text-xs font-medium text-gray-500 uppercase px-4 py-2"},"Test Name"),e("th",{class:"text-left text-xs font-medium text-gray-500 uppercase px-4 py-2"},"Status"),e("th",{class:"text-left text-xs font-medium text-gray-500 uppercase px-4 py-2"},"Severity"),e("th",{class:"text-left text-xs font-medium text-gray-500 uppercase px-4 py-2"},"Records"),e("th",{class:"text-left text-xs font-medium text-gray-500 uppercase px-4 py-2"},"Threshold"),e("th",{class:"text-left text-xs font-medium text-gray-500 uppercase px-4 py-2"},"Time")])],-1)),e("tbody",null,[(o(!0),n(R,null,M(s.value.test_evidence,i=>(o(),n("tr",{key:i.name,class:"border-b border-gray-100"},[e("td",ut,a(i.test_name),1),e("td",ct,[u(l(b),{variant:Y(i.test_status)},{default:g(()=>[c(a(i.test_status),1)]),_:2},1032,["variant"])]),e("td",gt,[i.severity?(o(),k(l(b),{key:0,variant:A(i.severity)},{default:g(()=>[c(a(i.severity),1)]),_:2},1032,["variant"])):(o(),n("span",pt,"-"))]),e("td",xt,a((i.records_processed||0).toLocaleString()),1),e("td",_t,[i.threshold_breached?(o(),n("span",mt,"Breached")):(o(),n("span",vt,"OK"))]),e("td",yt,a(i.execution_time_ms?i.execution_time_ms+"ms":"-"),1)]))),128))])])])):(o(),n("div",ft,[...t[24]||(t[24]=[e("p",null,"No test evidence recorded for this execution.",-1)])]))])):d("",!0),p.value==="findings"?(o(),n("div",bt,[h.value.length>0?(o(),n("div",ht,[(o(!0),n(R,null,M(h.value,i=>(o(),n("div",{key:i.name,class:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer",onClick:ee=>r.$router.push(`/findings/${i.name}`)},[e("div",wt,[e("div",null,[e("p",Ct,a(i.finding_title),1),e("p",St,a(i.finding_category),1)]),e("div",Tt,[u(l(b),{variant:A(i.severity||i.risk_rating)},{default:g(()=>[c(a(i.severity||i.risk_rating),1)]),_:2},1032,["variant"]),u(l(b),{variant:Z(i.finding_status)},{default:g(()=>[c(a(i.finding_status),1)]),_:2},1032,["variant"])])])],8,kt))),128))])):(o(),n("div",Rt,[...t[25]||(t[25]=[e("p",null,"No findings generated from this execution.",-1)])]))])):d("",!0),p.value==="data"?(o(),n("div",Et,[s.value.input_data?(o(),n("div",Pt,[t[26]||(t[26]=e("h3",{class:"font-semibold text-gray-900 mb-2"},"Input Data",-1)),e("pre",Ft,a(E(s.value.input_data)),1)])):d("",!0),s.value.output_data?(o(),n("div",Mt,[t[27]||(t[27]=e("h3",{class:"font-semibold text-gray-900 mb-2"},"Output Data",-1)),e("pre",$t,a(E(s.value.output_data)),1)])):d("",!0),s.value.result_json?(o(),n("div",At,[t[28]||(t[28]=e("h3",{class:"font-semibold text-gray-900 mb-2"},"Result",-1)),e("pre",Dt,a(E(s.value.result_json)),1)])):d("",!0),!s.value.input_data&&!s.value.output_data&&!s.value.result_json?(o(),n("div",Nt,[...t[29]||(t[29]=[e("p",null,"No execution data available.",-1)])])):d("",!0)])):d("",!0),p.value==="performance"?(o(),n("div",Vt,[e("div",Bt,[e("div",Lt,[t[30]||(t[30]=e("p",{class:"text-sm text-gray-600"},"Records Processed",-1)),e("p",jt,a((s.value.records_processed||0).toLocaleString()),1)]),e("div",Ot,[t[31]||(t[31]=e("p",{class:"text-sm text-gray-600"},"Processing Speed",-1)),e("p",Wt,a(s.value.records_per_second?Math.round(s.value.records_per_second)+"/s":"-"),1)]),e("div",Ut,[t[32]||(t[32]=e("p",{class:"text-sm text-gray-600"},"Memory Usage",-1)),e("p",qt,a(s.value.memory_usage_mb?s.value.memory_usage_mb+" MB":"-"),1)]),e("div",It,[t[33]||(t[33]=e("p",{class:"text-sm text-gray-600"},"CPU Usage",-1)),e("p",Jt,a(s.value.cpu_usage_percent?s.value.cpu_usage_percent+"%":"-"),1)])]),e("div",Qt,[e("div",zt,[t[34]||(t[34]=e("p",{class:"text-sm text-gray-600"},"Retry Count",-1)),e("p",Ht,a(s.value.retry_count||0)+" / "+a(s.value.max_retries||3),1)]),e("div",Kt,[t[35]||(t[35]=e("p",{class:"text-sm text-gray-600"},"Queue Wait Time",-1)),e("p",Gt,a(T(s.value.queue_wait_seconds)),1)])])])):d("",!0),p.value==="errors"?(o(),n("div",Xt,[s.value.error_occurred?(o(),n("div",Yt,[e("div",Zt,[e("div",null,[t[36]||(t[36]=e("p",{class:"text-sm font-medium text-red-800"},"Error Type",-1)),e("p",es,a(s.value.error_type||"Unknown"),1)]),e("div",null,[t[37]||(t[37]=e("p",{class:"text-sm font-medium text-red-800"},"Error Message",-1)),e("p",ts,a(s.value.error_message),1)]),s.value.error_traceback?(o(),n("div",ss,[t[38]||(t[38]=e("p",{class:"text-sm font-medium text-red-800 mb-1"},"Traceback",-1)),e("pre",as,a(s.value.error_traceback),1)])):d("",!0)])])):(o(),n("div",rs,[u(l(ge),{class:"h-12 w-12 text-green-300 mx-auto mb-3"}),t[39]||(t[39]=e("p",null,"No errors occurred during this execution.",-1))]))])):d("",!0)])])],64)):(o(),n("div",os,[t[41]||(t[41]=e("p",{class:"text-gray-600"},"Failed to load execution details.",-1)),u(l(C),{onClick:f,class:"mt-4"},{default:g(()=>[...t[40]||(t[40]=[c("Retry",-1)])]),_:1})]))])}}};export{ls as default};
//# sourceMappingURL=AgentExecutionDetail-C5ctxajU.js.map
