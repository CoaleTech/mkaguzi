var Ae=Object.defineProperty;var xe=Object.getOwnPropertySymbols;var Ee=Object.prototype.hasOwnProperty,De=Object.prototype.propertyIsEnumerable;var he=(k,u,f)=>u in k?Ae(k,u,{enumerable:!0,configurable:!0,writable:!0,value:f}):k[u]=f,ce=(k,u)=>{for(var f in u||(u={}))Ee.call(u,f)&&he(k,f,u[f]);if(xe)for(var f of xe(u))De.call(u,f)&&he(k,f,u[f]);return k};var U=(k,u,f)=>new Promise((A,g)=>{var S=x=>{try{y(f.next(x))}catch(s){g(s)}},V=x=>{try{y(f.throw(x))}catch(s){g(s)}},y=x=>x.done?A(x.value):Promise.resolve(x.value).then(S,V);y((f=f.apply(k,u)).next())});import{b as Ce,w as Te,j as w,l as _,p as m,q as e,H as P,s as o,u as b,v as i,y as L,z as T,A as v,r as q,F as J,x as K,B,C as pe,$ as ke,ac as W,ad as X,ah as _e,Q as Fe,a6 as Ue}from"./vue-DciwFjI_.js";import{b as ae,d as Y,a as R,c as M,e as Re,L as se,k as ie,I as ne,D as Le,l as Oe,m as G,_ as Ie,n as Ne}from"./index-qIC3Tfxg.js";import{m as qe,a4 as le,$ as $e,N as be,ao as Pe,D as re,bk as fe,a6 as me,bh as je,A as Ve,ae as Be,l as Qe,b as Me,C as Se,ad as ze,bl as He,n as Ge,af as We,T as Je,a1 as we,_ as Ke,a2 as Ye,I as Xe,U as Ze,F as et,c as tt,o as st,av as lt,ag as at}from"./icons-CtLkBOsu.js";import"./charts-DlPBe6v3.js";import"./utils-Bcd7wHeW.js";const ot={class:"bg-white rounded-xl border p-4"},it={class:"flex flex-wrap items-center gap-4"},nt={class:"flex-1 min-w-[200px] max-w-md"},rt={class:"w-48"},dt={class:"w-40"},ut={class:"w-44"},ct={class:"w-36"},pt={class:"flex items-center gap-2 ml-auto"},mt={key:0,class:"flex flex-wrap items-center gap-2 mt-3 pt-3 border-t"},gt={__name:"TestFilters",props:{filters:{type:Object,default:()=>({})}},emits:["update:filters","refresh","create"],setup(k,{emit:u}){const f=k,A=u,g=Ce({search:"",category:"",testType:"",logicType:"",status:""});Te(()=>f.filters,r=>{r&&Object.assign(g,r)},{immediate:!0,deep:!0});const S=[{label:"All Categories",value:""},{label:"Duplicate Detection",value:"Duplicate Detection"},{label:"Outlier Analysis",value:"Outlier Analysis"},{label:"Trend Analysis",value:"Trend Analysis"},{label:"Ratio Analysis",value:"Ratio Analysis"},{label:"Completeness Check",value:"Completeness Check"},{label:"Validity Check",value:"Validity Check"},{label:"Accuracy Check",value:"Accuracy Check"},{label:"Timeliness Check",value:"Timeliness Check"},{label:"Consistency Check",value:"Consistency Check"},{label:"Custom Analysis",value:"Custom Analysis"}],V=[{label:"All Types",value:""},{label:"Substantive",value:"Substantive"},{label:"Controls",value:"Controls"},{label:"Analytical",value:"Analytical"},{label:"Compliance",value:"Compliance"}],y=[{label:"All Logic Types",value:""},{label:"SQL Query",value:"SQL Query"},{label:"Python Script",value:"Python Script"},{label:"Built-in Function",value:"Built-in Function"}],x=[{label:"All Status",value:""},{label:"Active",value:"Active"},{label:"Inactive",value:"Inactive"},{label:"Under Review",value:"Under Review"}],s=w(()=>Object.values(g).some(r=>r!==""));function E(){A("update:filters",ce({},g))}function D(r){g[r]="",E()}function z(){Object.keys(g).forEach(r=>{g[r]=""}),E()}return(r,l)=>(m(),_("div",ot,[e("div",it,[e("div",nt,[o(i(ae),{modelValue:g.search,"onUpdate:modelValue":[l[0]||(l[0]=a=>g.search=a),E],type:"text",placeholder:"Search tests by name, ID, or description...",debounce:300},{prefix:b(()=>[o(i(qe),{class:"h-4 w-4 text-gray-400"})]),_:1},8,["modelValue"])]),e("div",rt,[o(i(Y),{modelValue:g.category,"onUpdate:modelValue":[l[1]||(l[1]=a=>g.category=a),E],options:S,placeholder:"All Categories"},null,8,["modelValue"])]),e("div",dt,[o(i(Y),{modelValue:g.testType,"onUpdate:modelValue":[l[2]||(l[2]=a=>g.testType=a),E],options:V,placeholder:"All Types"},null,8,["modelValue"])]),e("div",ut,[o(i(Y),{modelValue:g.logicType,"onUpdate:modelValue":[l[3]||(l[3]=a=>g.logicType=a),E],options:y,placeholder:"All Logic Types"},null,8,["modelValue"])]),e("div",ct,[o(i(Y),{modelValue:g.status,"onUpdate:modelValue":[l[4]||(l[4]=a=>g.status=a),E],options:x,placeholder:"All Status"},null,8,["modelValue"])]),e("div",pt,[s.value?(m(),L(i(R),{key:0,variant:"outline",onClick:z},{prefix:b(()=>[o(i(le),{class:"h-4 w-4"})]),default:b(()=>[l[12]||(l[12]=T(" Clear ",-1))]),_:1})):P("",!0),o(i(R),{variant:"outline",onClick:l[5]||(l[5]=a=>r.$emit("refresh"))},{prefix:b(()=>[o(i($e),{class:"h-4 w-4"})]),default:b(()=>[l[13]||(l[13]=T(" Refresh ",-1))]),_:1}),o(i(R),{variant:"solid",onClick:l[6]||(l[6]=a=>r.$emit("create"))},{prefix:b(()=>[o(i(be),{class:"h-4 w-4"})]),default:b(()=>[l[14]||(l[14]=T(" New Test ",-1))]),_:1})])]),s.value?(m(),_("div",mt,[l[15]||(l[15]=e("span",{class:"text-xs text-gray-500"},"Active filters:",-1)),g.search?(m(),L(i(M),{key:0,theme:"blue",class:"cursor-pointer",onClick:l[7]||(l[7]=a=>D("search"))},{default:b(()=>[T(' Search: "'+v(g.search)+'" ',1),o(i(le),{class:"h-3 w-3 ml-1"})]),_:1})):P("",!0),g.category?(m(),L(i(M),{key:1,theme:"purple",class:"cursor-pointer",onClick:l[8]||(l[8]=a=>D("category"))},{default:b(()=>[T(" Category: "+v(g.category)+" ",1),o(i(le),{class:"h-3 w-3 ml-1"})]),_:1})):P("",!0),g.testType?(m(),L(i(M),{key:2,theme:"indigo",class:"cursor-pointer",onClick:l[9]||(l[9]=a=>D("testType"))},{default:b(()=>[T(" Type: "+v(g.testType)+" ",1),o(i(le),{class:"h-3 w-3 ml-1"})]),_:1})):P("",!0),g.logicType?(m(),L(i(M),{key:3,theme:"orange",class:"cursor-pointer",onClick:l[10]||(l[10]=a=>D("logicType"))},{default:b(()=>[T(" Logic: "+v(g.logicType)+" ",1),o(i(le),{class:"h-3 w-3 ml-1"})]),_:1})):P("",!0),g.status?(m(),L(i(M),{key:4,theme:"green",class:"cursor-pointer",onClick:l[11]||(l[11]=a=>D("status"))},{default:b(()=>[T(" Status: "+v(g.status)+" ",1),o(i(le),{class:"h-3 w-3 ml-1"})]),_:1})):P("",!0)])):P("",!0)]))}},vt={class:"flex h-[75vh]"},yt={class:"w-56 border-r bg-gray-50 p-4 flex flex-col"},bt={class:"space-y-1 flex-1"},ft=["onClick"],xt={class:"text-sm"},ht={class:"mt-4 pt-4 border-t"},_t={class:"text-xs text-gray-500 mb-2"},wt={class:"w-full bg-gray-200 rounded-full h-2"},Ct={class:"flex-1 flex flex-col overflow-hidden"},Tt={class:"flex-1 overflow-y-auto p-6"},kt={class:"space-y-4"},$t={class:"grid grid-cols-3 gap-4"},Vt={class:"grid grid-cols-3 gap-4"},St={class:"space-y-4"},At={class:"grid grid-cols-2 gap-4"},Et={class:"mt-6"},Dt={class:"mt-6"},Ft={class:"space-y-4"},Ut={class:"grid grid-cols-2 gap-4"},Rt={key:0,class:"mt-4"},Lt={class:"block text-sm font-medium text-gray-700 mb-2"},Ot={class:"border rounded-lg overflow-hidden"},It={class:"bg-gray-800 px-3 py-2 text-xs text-gray-400 flex items-center justify-between"},Nt={key:1,class:"mt-4"},qt={class:"block text-sm font-medium text-gray-700 mb-2"},Pt={class:"border rounded-lg overflow-hidden"},jt={class:"bg-gray-800 px-3 py-2 text-xs text-gray-400 flex items-center justify-between"},Bt={class:"flex gap-2"},Qt={class:"mt-6"},Mt={class:"space-y-4"},zt={class:"mt-6"},Ht={class:"space-y-4"},Gt={class:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4"},Wt={class:"flex items-start gap-3"},Jt={class:"mt-4"},Kt={class:"space-y-4"},Yt={class:"grid grid-cols-3 gap-4"},Xt={class:"grid grid-cols-2 gap-4"},Zt={class:"mt-6 bg-gray-50 rounded-lg p-4"},es={class:"grid grid-cols-3 gap-4"},ts={class:"bg-white rounded-lg p-4 border"},ss={class:"text-2xl font-bold text-blue-600"},ls={class:"bg-white rounded-lg p-4 border"},as={class:"text-2xl font-bold text-green-600"},os={class:"bg-white rounded-lg p-4 border"},is={class:"text-2xl font-bold text-gray-600"},ns={class:"border-t bg-gray-50 px-6 py-4 flex items-center justify-between"},rs={class:"flex items-center gap-2"},ds={__name:"TestLibraryForm",props:{show:{type:Boolean,default:!1},test:{type:Object,default:null}},emits:["update:show","saved"],setup(k,{emit:u}){const f=k,A=u,g=w({get:()=>f.show,set:n=>A("update:show",n)}),S=w(()=>{var n;return!!((n=f.test)!=null&&n.name)}),V=q(!1),y=q(0),x=[{id:"basic",title:"Basic Information",icon:Pe,description:"Test identification and classification"},{id:"data",title:"Data Source",icon:re,description:"Define data requirements and filters"},{id:"logic",title:"Test Logic",icon:fe,description:"Configure SQL query or Python script"},{id:"results",title:"Expected Results",icon:me,description:"Define expected outcomes and interpretations"},{id:"thresholds",title:"Thresholds",icon:je,description:"Set warning and critical thresholds"},{id:"status",title:"Status & Usage",icon:Ve,description:"Status, versioning, and usage tracking"}],s=Ce({test_id:"",test_name:"",test_category:"",sub_category:"",test_type:"",risk_area:"",description:"",objective:"",data_source:"",data_doctype:"",required_data_fields:[],data_filters:[],test_logic_type:"",sql_query:"",python_script:"",builtin_function:"",test_parameters:[],expected_result:"",interpretation_guide:"",expected_results:[],threshold_settings:[],status:"Active",version:"1.0.0",last_updated:"",created_by:"",reviewed_by:"",usage_count:0,success_rate:0,last_execution:"",notes:""}),E=[{label:"Duplicate Detection",value:"Duplicate Detection"},{label:"Outlier Analysis",value:"Outlier Analysis"},{label:"Trend Analysis",value:"Trend Analysis"},{label:"Ratio Analysis",value:"Ratio Analysis"},{label:"Completeness Check",value:"Completeness Check"},{label:"Validity Check",value:"Validity Check"},{label:"Accuracy Check",value:"Accuracy Check"},{label:"Timeliness Check",value:"Timeliness Check"},{label:"Consistency Check",value:"Consistency Check"},{label:"Custom Analysis",value:"Custom Analysis"}],D=[{label:"Substantive",value:"Substantive"},{label:"Controls",value:"Controls"},{label:"Analytical",value:"Analytical"},{label:"Compliance",value:"Compliance"}],z=[{label:"SQL Query",value:"SQL Query"},{label:"Python Script",value:"Python Script"},{label:"Built-in Function",value:"Built-in Function"}],r=[{label:"Active",value:"Active"},{label:"Inactive",value:"Inactive"},{label:"Under Review",value:"Under Review"}],l=[{key:"field_name",label:"Field Name",fieldType:"text",width:"150px",required:!0},{key:"field_type",label:"Field Type",fieldType:"select",width:"120px",options:[{label:"Data",value:"Data"},{label:"Int",value:"Int"},{label:"Float",value:"Float"},{label:"Currency",value:"Currency"},{label:"Date",value:"Date"},{label:"Datetime",value:"Datetime"},{label:"Link",value:"Link"},{label:"Select",value:"Select"}]},{key:"is_required",label:"Required",fieldType:"check",width:"80px"},{key:"description",label:"Description",fieldType:"text",width:"200px"}],a=[{key:"filter_field",label:"Filter Field",fieldType:"text",width:"150px",required:!0},{key:"operator",label:"Operator",fieldType:"select",width:"120px",options:[{label:"Equals (=)",value:"="},{label:"Not Equals (!=)",value:"!="},{label:"Greater Than (>)",value:">"},{label:"Less Than (<)",value:"<"},{label:"Like",value:"like"},{label:"In",value:"in"},{label:"Between",value:"between"}]},{key:"default_value",label:"Default Value",fieldType:"text",width:"150px"},{key:"is_dynamic",label:"Dynamic",fieldType:"check",width:"80px"}],F=[{key:"parameter_name",label:"Parameter Name",fieldType:"text",width:"150px",required:!0},{key:"parameter_type",label:"Type",fieldType:"select",width:"100px",options:[{label:"String",value:"String"},{label:"Integer",value:"Integer"},{label:"Float",value:"Float"},{label:"Date",value:"Date"},{label:"Boolean",value:"Boolean"},{label:"List",value:"List"}]},{key:"default_value",label:"Default Value",fieldType:"text",width:"150px"},{key:"description",label:"Description",fieldType:"text",width:"200px"}],j=[{key:"condition",label:"Condition",fieldType:"text",width:"200px",required:!0},{key:"result_status",label:"Result Status",fieldType:"select",width:"100px",options:[{label:"Pass",value:"Pass"},{label:"Fail",value:"Fail"},{label:"Warning",value:"Warning"}]},{key:"severity",label:"Severity",fieldType:"select",width:"100px",options:[{label:"Low",value:"Low"},{label:"Medium",value:"Medium"},{label:"High",value:"High"},{label:"Critical",value:"Critical"}]},{key:"action_required",label:"Action Required",fieldType:"text",width:"180px"}],I=[{key:"metric_name",label:"Metric",fieldType:"text",width:"150px",required:!0},{key:"operator",label:"Operator",fieldType:"select",width:"120px",options:[{label:"Greater Than (>)",value:">"},{label:"Greater Than or Equal (>=)",value:">="},{label:"Less Than (<)",value:"<"},{label:"Less Than or Equal (<=)",value:"<="},{label:"Equals (=)",value:"="},{label:"Not Equals (!=)",value:"!="}]},{key:"warning_threshold",label:"Warning",fieldType:"float",width:"100px"},{key:"critical_threshold",label:"Critical",fieldType:"float",width:"100px"},{key:"description",label:"Description",fieldType:"text",width:"180px"}];Te(()=>f.test,n=>{n?Object.keys(s).forEach(t=>{n[t]!==void 0&&(s[t]=n[t])}):de()},{immediate:!0});const H=w(()=>[!!(s.test_name&&s.test_category),!0,!!s.test_logic_type,!0,!0,!!s.status]),O=w(()=>H.value.filter(Boolean).length),p=w(()=>Math.round(O.value/x.length*100));function c(n){return H.value[n]}function h(n){return y.value===n?"text-blue-600":c(n)?"text-green-500":"text-gray-400"}function Z(n){y.value=n}function Q(){y.value<x.length-1&&y.value++}function ee(){y.value>0&&y.value--}function te(){s.sql_query&&(s.sql_query=s.sql_query.replace(/\bSELECT\b/gi,`
SELECT`).replace(/\bFROM\b/gi,`
FROM`).replace(/\bWHERE\b/gi,`
WHERE`).replace(/\bAND\b/gi,`
  AND`).replace(/\bOR\b/gi,`
  OR`).replace(/\bGROUP BY\b/gi,`
GROUP BY`).replace(/\bORDER BY\b/gi,`
ORDER BY`).replace(/\bHAVING\b/gi,`
HAVING`).replace(/\bLEFT JOIN\b/gi,`
LEFT JOIN`).replace(/\bRIGHT JOIN\b/gi,`
RIGHT JOIN`).replace(/\bINNER JOIN\b/gi,`
INNER JOIN`).trim())}function ge(){s.python_script=`def execute(data, params):
    '''
    Execute the audit test logic.
    
    Args:
        data: List of records from data source
        params: Test parameters dictionary
        
    Returns:
        dict: {
            'status': 'Pass' | 'Fail' | 'Warning',
            'exceptions': list of exception records,
            'summary': summary statistics dict
        }
    '''
    exceptions = []
    summary = {
        'total_records': len(data),
        'exceptions_found': 0,
        'pass_rate': 100.0
    }
    
    for record in data:
        # Add your test logic here
        # Example: Check for specific conditions
        if some_condition(record):
            exceptions.append({
                'record': record,
                'reason': 'Description of exception'
            })
    
    summary['exceptions_found'] = len(exceptions)
    summary['pass_rate'] = round((1 - len(exceptions) / len(data)) * 100, 2) if data else 100
    
    return {
        'status': 'Pass' if not exceptions else 'Fail',
        'exceptions': exceptions,
        'summary': summary
    }

def some_condition(record):
    '''Helper function to check condition'''
    # Implement your condition logic
    return False
`}function de(){Object.keys(s).forEach(n=>{Array.isArray(s[n])?s[n]=[]:typeof s[n]=="number"?s[n]=0:s[n]=""}),s.status="Active",s.version="1.0.0",y.value=0}function ue(){A("update:show",!1),de()}function ve(){return U(this,null,function*(){V.value=!0;try{console.log("Saving test:",s),A("saved",ce({},s)),ue()}catch(n){console.error("Error saving test:",n)}finally{V.value=!1}})}return(n,t)=>(m(),L(i(Le),{modelValue:g.value,"onUpdate:modelValue":t[27]||(t[27]=$=>g.value=$),options:{title:S.value?"Edit Test":"Create Audit Test",size:"7xl"}},{"body-content":b(()=>{var $,C,oe;return[e("div",vt,[e("div",yt,[e("div",bt,[(m(),_(J,null,K(x,(d,N)=>e("button",{key:d.id,onClick:ye=>Z(N),class:B(["w-full flex items-center gap-3 px-3 py-2 rounded-lg text-left transition-colors",y.value===N?"bg-blue-100 text-blue-700 font-medium":"text-gray-600 hover:bg-gray-100"])},[(m(),L(pe(d.icon),{class:B(["h-4 w-4",h(N)])},null,8,["class"])),e("span",xt,v(d.title),1),c(N)?(m(),L(i(Be),{key:0,class:"h-4 w-4 ml-auto text-green-500"})):P("",!0)],10,ft)),64))]),e("div",ht,[e("div",_t," Progress: "+v(O.value)+"/"+v(x.length)+" sections ",1),e("div",wt,[e("div",{class:"bg-blue-600 h-2 rounded-full transition-all",style:ke({width:`${p.value}%`})},null,4)])])]),e("div",Ct,[o(Re,{icon:($=x[y.value])==null?void 0:$.icon,title:(C=x[y.value])==null?void 0:C.title,description:(oe=x[y.value])==null?void 0:oe.description},null,8,["icon","title","description"]),e("div",Tt,[W(e("div",kt,[e("div",$t,[o(i(ae),{modelValue:s.test_id,"onUpdate:modelValue":t[0]||(t[0]=d=>s.test_id=d),label:"Test ID",type:"text",placeholder:"Auto-generated",disabled:""},null,8,["modelValue"]),o(i(ae),{modelValue:s.test_name,"onUpdate:modelValue":t[1]||(t[1]=d=>s.test_name=d),label:"Test Name *",type:"text",placeholder:"Enter test name"},null,8,["modelValue"]),e("div",null,[t[28]||(t[28]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Test Category *",-1)),o(i(Y),{modelValue:s.test_category,"onUpdate:modelValue":t[2]||(t[2]=d=>s.test_category=d),options:E,placeholder:"Select category"},null,8,["modelValue"])])]),e("div",Vt,[o(i(ae),{modelValue:s.sub_category,"onUpdate:modelValue":t[3]||(t[3]=d=>s.sub_category=d),label:"Sub Category",type:"text",placeholder:"Enter sub-category"},null,8,["modelValue"]),e("div",null,[t[29]||(t[29]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Risk Area",-1)),o(se,{modelValue:s.risk_area,"onUpdate:modelValue":t[4]||(t[4]=d=>s.risk_area=d),doctype:"Risk Type",placeholder:"Select risk area"},null,8,["modelValue"])]),e("div",null,[t[30]||(t[30]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Audit Type",-1)),o(i(Y),{modelValue:s.test_type,"onUpdate:modelValue":t[5]||(t[5]=d=>s.test_type=d),options:D,placeholder:"Select type"},null,8,["modelValue"])])]),e("div",null,[t[31]||(t[31]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Description",-1)),o(i(ie),{modelValue:s.description,"onUpdate:modelValue":t[6]||(t[6]=d=>s.description=d),content:s.description,placeholder:"Describe the test...","editor-class":"prose-sm max-w-none min-h-[100px]",bubbleMenu:!0},null,8,["modelValue","content"])]),e("div",null,[t[32]||(t[32]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Objective",-1)),o(i(ie),{modelValue:s.objective,"onUpdate:modelValue":t[7]||(t[7]=d=>s.objective=d),content:s.objective,placeholder:"What is the objective of this test?","editor-class":"prose-sm max-w-none min-h-[100px]",bubbleMenu:!0},null,8,["modelValue","content"])])],512),[[X,y.value===0]]),W(e("div",St,[e("div",At,[e("div",null,[t[33]||(t[33]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Data Source",-1)),o(se,{modelValue:s.data_source,"onUpdate:modelValue":t[8]||(t[8]=d=>s.data_source=d),doctype:"BC Data Source",placeholder:"Select data source"},null,8,["modelValue"])]),e("div",null,[t[34]||(t[34]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Data DocType",-1)),o(se,{modelValue:s.data_doctype,"onUpdate:modelValue":t[9]||(t[9]=d=>s.data_doctype=d),doctype:"DocType",placeholder:"Select DocType"},null,8,["modelValue"])])]),e("div",Et,[o(ne,{modelValue:s.required_data_fields,"onUpdate:modelValue":t[10]||(t[10]=d=>s.required_data_fields=d),title:"Required Data Fields",modalTitle:"Data Field",columns:l,autoAddRow:!1},null,8,["modelValue"])]),e("div",Dt,[o(ne,{modelValue:s.data_filters,"onUpdate:modelValue":t[11]||(t[11]=d=>s.data_filters=d),title:"Data Filters",modalTitle:"Data Filter",columns:a,autoAddRow:!1},null,8,["modelValue"])])],512),[[X,y.value===1]]),W(e("div",Ft,[e("div",Ut,[e("div",null,[t[35]||(t[35]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Test Logic Type *",-1)),o(i(Y),{modelValue:s.test_logic_type,"onUpdate:modelValue":t[12]||(t[12]=d=>s.test_logic_type=d),options:z,placeholder:"Select logic type"},null,8,["modelValue"])]),e("div",null,[t[36]||(t[36]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Built-in Function",-1)),o(se,{modelValue:s.builtin_function,"onUpdate:modelValue":t[13]||(t[13]=d=>s.builtin_function=d),doctype:"Built In Function",placeholder:"Select function",disabled:s.test_logic_type!=="Built-in Function"},null,8,["modelValue","disabled"])])]),s.test_logic_type==="SQL Query"?(m(),_("div",Rt,[e("label",Lt,[o(i(re),{class:"h-4 w-4 inline mr-1"}),t[37]||(t[37]=T(" SQL Query ",-1))]),e("div",Ot,[e("div",It,[t[39]||(t[39]=e("span",null,"SQL",-1)),o(i(R),{variant:"ghost",size:"sm",class:"text-gray-400 hover:text-white",onClick:te},{default:b(()=>[...t[38]||(t[38]=[T(" Format ",-1)])]),_:1})]),W(e("textarea",{"onUpdate:modelValue":t[14]||(t[14]=d=>s.sql_query=d),class:"w-full h-64 p-4 font-mono text-sm bg-gray-900 text-green-400 focus:outline-none resize-none",placeholder:`-- Enter your SQL query here
SELECT 
    field1,
    field2,
    COUNT(*) as count
FROM \`tabDocType\`
WHERE condition = 'value'
GROUP BY field1, field2
HAVING COUNT(*) > 1;`},null,512),[[_e,s.sql_query]])])])):P("",!0),s.test_logic_type==="Python Script"?(m(),_("div",Nt,[e("label",qt,[o(i(fe),{class:"h-4 w-4 inline mr-1"}),t[40]||(t[40]=T(" Python Script ",-1))]),e("div",Pt,[e("div",jt,[t[42]||(t[42]=e("span",null,"Python",-1)),e("div",Bt,[o(i(R),{variant:"ghost",size:"sm",class:"text-gray-400 hover:text-white",onClick:ge},{default:b(()=>[...t[41]||(t[41]=[T(" Insert Template ",-1)])]),_:1})])]),W(e("textarea",{"onUpdate:modelValue":t[15]||(t[15]=d=>s.python_script=d),class:"w-full h-64 p-4 font-mono text-sm bg-gray-900 text-yellow-300 focus:outline-none resize-none",placeholder:`# Enter your Python script here
def execute(data, params):
    '''
    Args:
        data: List of records from data source
        params: Test parameters dictionary
    Returns:
        dict: {
            'status': 'Pass'/'Fail'/'Warning',
            'exceptions': list,
            'summary': dict
        }
    '''
    exceptions = []
    
    for record in data:
        # Your test logic here
        pass
    
    return {
        'status': 'Pass' if not exceptions else 'Fail',
        'exceptions': exceptions,
        'summary': {'total': len(data), 'exceptions': len(exceptions)}
    }`},null,512),[[_e,s.python_script]])])])):P("",!0),e("div",Qt,[o(ne,{modelValue:s.test_parameters,"onUpdate:modelValue":t[16]||(t[16]=d=>s.test_parameters=d),title:"Test Parameters",modalTitle:"Parameter",columns:F,autoAddRow:!1},null,8,["modelValue"])])],512),[[X,y.value===2]]),W(e("div",Mt,[e("div",null,[t[43]||(t[43]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Expected Result Description",-1)),o(i(ie),{modelValue:s.expected_result,"onUpdate:modelValue":t[17]||(t[17]=d=>s.expected_result=d),content:s.expected_result,placeholder:"Describe the expected results...","editor-class":"prose-sm max-w-none min-h-[100px]",bubbleMenu:!0},null,8,["modelValue","content"])]),e("div",null,[t[44]||(t[44]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Interpretation Guidelines",-1)),o(i(ie),{modelValue:s.interpretation_guide,"onUpdate:modelValue":t[18]||(t[18]=d=>s.interpretation_guide=d),content:s.interpretation_guide,placeholder:"How should results be interpreted?","editor-class":"prose-sm max-w-none min-h-[100px]",bubbleMenu:!0},null,8,["modelValue","content"])]),e("div",zt,[o(ne,{modelValue:s.expected_results,"onUpdate:modelValue":t[19]||(t[19]=d=>s.expected_results=d),title:"Expected Result Conditions",modalTitle:"Expected Result",columns:j,autoAddRow:!1},null,8,["modelValue"])])],512),[[X,y.value===3]]),W(e("div",Ht,[e("div",Gt,[e("div",Wt,[o(i(Qe),{class:"h-5 w-5 text-blue-600 mt-0.5"}),t[45]||(t[45]=e("div",{class:"text-sm text-blue-700"},[e("p",{class:"font-medium"},"Configure Thresholds"),e("p",null,"Define thresholds to automatically classify test results as Pass, Warning, or Fail based on metrics.")],-1))])]),e("div",Jt,[o(ne,{modelValue:s.threshold_settings,"onUpdate:modelValue":t[20]||(t[20]=d=>s.threshold_settings=d),title:"Threshold Configurations",modalTitle:"Threshold",columns:I,autoAddRow:!1},null,8,["modelValue"])])],512),[[X,y.value===4]]),W(e("div",Kt,[e("div",Yt,[e("div",null,[t[46]||(t[46]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Status *",-1)),o(i(Y),{modelValue:s.status,"onUpdate:modelValue":t[21]||(t[21]=d=>s.status=d),options:r,placeholder:"Select status"},null,8,["modelValue"])]),o(i(ae),{modelValue:s.version,"onUpdate:modelValue":t[22]||(t[22]=d=>s.version=d),label:"Version",type:"text",placeholder:"e.g., 1.0.0"},null,8,["modelValue"]),o(i(ae),{modelValue:s.last_updated,"onUpdate:modelValue":t[23]||(t[23]=d=>s.last_updated=d),label:"Last Updated",type:"date",disabled:""},null,8,["modelValue"])]),e("div",Xt,[e("div",null,[t[47]||(t[47]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Created By",-1)),o(se,{modelValue:s.created_by,"onUpdate:modelValue":t[24]||(t[24]=d=>s.created_by=d),doctype:"User",placeholder:"Select user",disabled:""},null,8,["modelValue"])]),e("div",null,[t[48]||(t[48]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Reviewed By",-1)),o(se,{modelValue:s.reviewed_by,"onUpdate:modelValue":t[25]||(t[25]=d=>s.reviewed_by=d),doctype:"User",placeholder:"Select reviewer"},null,8,["modelValue"])])]),e("div",Zt,[t[52]||(t[52]=e("h4",{class:"text-sm font-medium text-gray-700 mb-4"},"Usage Statistics",-1)),e("div",es,[e("div",ts,[e("div",ss,v(s.usage_count||0),1),t[49]||(t[49]=e("div",{class:"text-sm text-gray-500"},"Total Executions",-1))]),e("div",ls,[e("div",as,v(s.success_rate||0)+"%",1),t[50]||(t[50]=e("div",{class:"text-sm text-gray-500"},"Success Rate",-1))]),e("div",os,[e("div",is,v(s.last_execution||"Never"),1),t[51]||(t[51]=e("div",{class:"text-sm text-gray-500"},"Last Execution",-1))])])]),e("div",null,[t[53]||(t[53]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Notes",-1)),o(i(ie),{modelValue:s.notes,"onUpdate:modelValue":t[26]||(t[26]=d=>s.notes=d),content:s.notes,placeholder:"Additional notes...","editor-class":"prose-sm max-w-none min-h-[100px]",bubbleMenu:!0},null,8,["modelValue","content"])])],512),[[X,y.value===5]])]),e("div",ns,[o(i(R),{variant:"outline",onClick:ee,disabled:y.value===0},{prefix:b(()=>[o(i(Me),{class:"h-4 w-4"})]),default:b(()=>[t[54]||(t[54]=T(" Previous ",-1))]),_:1},8,["disabled"]),e("div",rs,[o(i(R),{variant:"outline",onClick:ue},{default:b(()=>[...t[55]||(t[55]=[T("Cancel",-1)])]),_:1}),y.value<x.length-1?(m(),L(i(R),{key:0,variant:"solid",onClick:Q},{suffix:b(()=>[o(i(Se),{class:"h-4 w-4"})]),default:b(()=>[t[56]||(t[56]=T(" Next ",-1))]),_:1})):(m(),L(i(R),{key:1,variant:"solid",theme:"green",onClick:ve,loading:V.value},{prefix:b(()=>[o(i(ze),{class:"h-4 w-4"})]),default:b(()=>[T(" "+v(S.value?"Update Test":"Create Test"),1)]),_:1},8,["loading"]))])])])])]}),_:1},8,["modelValue","options"]))}},us={class:"space-y-4"},cs={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4"},ps=["onClick"],ms={class:"flex items-center gap-3"},gs={class:"text-2xl font-bold text-gray-900"},vs={class:"text-xs text-gray-500"},ys={class:"grid grid-cols-1 lg:grid-cols-2 gap-4"},bs={class:"bg-white rounded-xl border p-4"},fs={class:"space-y-3"},xs={class:"w-32 text-sm text-gray-600 truncate"},hs={class:"flex-1 bg-gray-100 rounded-full h-4 overflow-hidden"},_s={class:"w-16 text-right text-sm font-medium text-gray-700"},ws={class:"text-gray-400 text-xs"},Cs={class:"bg-white rounded-xl border p-4"},Ts={class:"grid grid-cols-2 gap-4"},ks=["onClick"],$s={class:"text-sm text-gray-600"},Vs={class:"text-xs text-gray-400 mt-1"},Ss={class:"grid grid-cols-1 lg:grid-cols-3 gap-4"},As={class:"bg-white rounded-xl border p-4"},Es={class:"flex items-center justify-center"},Ds={class:"relative h-32 w-32"},Fs={class:"transform -rotate-90",viewBox:"0 0 36 36"},Us=["stroke","stroke-dasharray"],Rs={class:"absolute inset-0 flex items-center justify-center"},Ls={class:"text-center"},Os={class:"text-2xl font-bold text-gray-900"},Is={class:"bg-white rounded-xl border p-4"},Ns={class:"space-y-3"},qs=["onClick"],Ps={class:"flex items-center gap-2"},js={class:"text-sm text-gray-700"},Bs={class:"bg-white rounded-xl border p-4"},Qs={class:"space-y-4"},Ms={class:"flex items-center justify-between"},zs={class:"text-lg font-semibold text-gray-900"},Hs={class:"flex items-center justify-between"},Gs={class:"text-sm font-medium text-blue-600 truncate max-w-[150px]"},Ws={class:"flex items-center justify-between"},Js={class:"text-lg font-semibold text-gray-900"},Ks={class:"flex items-center justify-between"},Ys={__name:"TestStats",props:{tests:{type:Array,default:()=>[]},activeFilter:{type:String,default:""}},emits:["filter"],setup(k){const u=k,f=w(()=>{const r=u.tests,l=r.length,a=r.filter(O=>O.status==="Active").length,F=r.filter(O=>O.status==="Inactive").length,j=r.filter(O=>O.status==="Under Review").length,I=r.filter(O=>O.test_type==="Substantive").length,H=r.filter(O=>O.test_type==="Controls").length;return[{label:"Total Tests",value:l,icon:He,bgColor:"bg-blue-100",iconColor:"text-blue-600",filterKey:null,filterValue:null},{label:"Active",value:a,icon:Ge,bgColor:"bg-green-100",iconColor:"text-green-600",filterKey:"status",filterValue:"Active",active:u.activeFilter==="Active"},{label:"Inactive",value:F,icon:We,bgColor:"bg-gray-100",iconColor:"text-gray-600",filterKey:"status",filterValue:"Inactive",active:u.activeFilter==="Inactive"},{label:"Under Review",value:j,icon:Je,bgColor:"bg-orange-100",iconColor:"text-orange-600",filterKey:"status",filterValue:"Under Review",active:u.activeFilter==="Under Review"},{label:"Substantive",value:I,icon:me,bgColor:"bg-purple-100",iconColor:"text-purple-600",filterKey:"test_type",filterValue:"Substantive",active:u.activeFilter==="Substantive"},{label:"Controls",value:H,icon:we,bgColor:"bg-indigo-100",iconColor:"text-indigo-600",filterKey:"test_type",filterValue:"Controls",active:u.activeFilter==="Controls"}]}),A=w(()=>{const r=u.tests,l={};r.forEach(j=>{const I=j.test_category||"Uncategorized";l[I]=(l[I]||0)+1});const a=r.length||1,F=["bg-blue-500","bg-green-500","bg-purple-500","bg-orange-500","bg-pink-500","bg-indigo-500","bg-teal-500","bg-red-500","bg-yellow-500","bg-cyan-500"];return Object.entries(l).map(([j,I],H)=>({name:j,count:I,percentage:Math.round(I/a*100),color:F[H%F.length]})).sort((j,I)=>I.count-j.count).slice(0,6)}),g=w(()=>{const r=u.tests,l=r.length||1;return[{name:"Substantive",count:r.filter(a=>a.test_type==="Substantive").length,icon:me,bgColor:"bg-purple-50 border-purple-200",iconColor:"text-purple-600",textColor:"text-purple-700",percentage:Math.round(r.filter(a=>a.test_type==="Substantive").length/l*100)},{name:"Controls",count:r.filter(a=>a.test_type==="Controls").length,icon:we,bgColor:"bg-indigo-50 border-indigo-200",iconColor:"text-indigo-600",textColor:"text-indigo-700",percentage:Math.round(r.filter(a=>a.test_type==="Controls").length/l*100)},{name:"Analytical",count:r.filter(a=>a.test_type==="Analytical").length,icon:Ke,bgColor:"bg-blue-50 border-blue-200",iconColor:"text-blue-600",textColor:"text-blue-700",percentage:Math.round(r.filter(a=>a.test_type==="Analytical").length/l*100)},{name:"Compliance",count:r.filter(a=>a.test_type==="Compliance").length,icon:Ye,bgColor:"bg-green-50 border-green-200",iconColor:"text-green-600",textColor:"text-green-700",percentage:Math.round(r.filter(a=>a.test_type==="Compliance").length/l*100)}]}),S=w(()=>{const r=u.tests;return[{name:"SQL Query",count:r.filter(l=>l.test_logic_type==="SQL Query").length,icon:re,iconColor:"text-blue-600",theme:"blue"},{name:"Python Script",count:r.filter(l=>l.test_logic_type==="Python Script").length,icon:fe,iconColor:"text-yellow-600",theme:"orange"},{name:"Built-in Function",count:r.filter(l=>l.test_logic_type==="Built-in Function").length,icon:Xe,iconColor:"text-gray-600",theme:"gray"}]}),V=w(()=>{const r=u.tests.filter(a=>a.success_rate!==void 0&&a.success_rate!==null);if(!r.length)return 0;const l=r.reduce((a,F)=>a+(F.success_rate||0),0);return Math.round(l/r.length)}),y=w(()=>{const r=V.value;return r>=80?"#22C55E":r>=60?"#F59E0B":"#EF4444"}),x=w(()=>u.tests.reduce((r,l)=>r+(l.usage_count||0),0)),s=w(()=>{var l;return u.tests.length&&((l=[...u.tests].sort((a,F)=>(F.usage_count||0)-(a.usage_count||0))[0])==null?void 0:l.test_name)||"N/A"}),E=w(()=>u.tests.length?Math.round(x.value/u.tests.length):0),D=w(()=>u.tests.filter(r=>r.status==="Under Review").length);function z(r){return r>=1e6?`${(r/1e6).toFixed(1)}M`:r>=1e3?`${(r/1e3).toFixed(1)}K`:r.toString()}return(r,l)=>(m(),_("div",us,[e("div",cs,[(m(!0),_(J,null,K(f.value,a=>(m(),_("div",{key:a.label,class:B(["bg-white rounded-xl border p-4 hover:shadow-md transition-shadow cursor-pointer",a.active?"ring-2 ring-blue-500":""]),onClick:F=>r.$emit("filter",a.filterKey,a.filterValue)},[e("div",ms,[e("div",{class:B(["p-2 rounded-lg",a.bgColor])},[(m(),L(pe(a.icon),{class:B(["h-5 w-5",a.iconColor])},null,8,["class"]))],2),e("div",null,[e("div",gs,v(a.value),1),e("div",vs,v(a.label),1)])])],10,ps))),128))]),e("div",ys,[e("div",bs,[l[0]||(l[0]=e("h3",{class:"text-sm font-medium text-gray-700 mb-4"},"Tests by Category",-1)),e("div",fs,[(m(!0),_(J,null,K(A.value,a=>(m(),_("div",{key:a.name,class:"flex items-center gap-3"},[e("div",xs,v(a.name),1),e("div",hs,[e("div",{class:B(["h-full rounded-full transition-all",a.color]),style:ke({width:`${a.percentage}%`})},null,6)]),e("div",_s,[T(v(a.count)+" ",1),e("span",ws,"("+v(a.percentage)+"%)",1)])]))),128))])]),e("div",Cs,[l[1]||(l[1]=e("h3",{class:"text-sm font-medium text-gray-700 mb-4"},"Tests by Type",-1)),e("div",Ts,[(m(!0),_(J,null,K(g.value,a=>(m(),_("div",{key:a.name,class:B(["p-4 rounded-lg border text-center hover:shadow-sm transition-shadow cursor-pointer",a.bgColor]),onClick:F=>r.$emit("filter","test_type",a.name)},[(m(),L(pe(a.icon),{class:B(["h-8 w-8 mx-auto mb-2",a.iconColor])},null,8,["class"])),e("div",{class:B(["text-2xl font-bold",a.textColor])},v(a.count),3),e("div",$s,v(a.name),1),e("div",Vs,v(a.percentage)+"% of total",1)],10,ks))),128))])])]),e("div",Ss,[e("div",As,[l[4]||(l[4]=e("h3",{class:"text-sm font-medium text-gray-700 mb-4"},"Average Success Rate",-1)),e("div",Es,[e("div",Ds,[(m(),_("svg",Fs,[l[2]||(l[2]=e("path",{d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",fill:"none",stroke:"#E5E7EB","stroke-width":"3"},null,-1)),e("path",{d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",fill:"none",stroke:y.value,"stroke-width":"3","stroke-dasharray":`${V.value}, 100`,"stroke-linecap":"round"},null,8,Us)])),e("div",Rs,[e("div",Ls,[e("div",Os,v(V.value)+"%",1),l[3]||(l[3]=e("div",{class:"text-xs text-gray-500"},"Success",-1))])])])])]),e("div",Is,[l[5]||(l[5]=e("h3",{class:"text-sm font-medium text-gray-700 mb-4"},"Test Logic Types",-1)),e("div",Ns,[(m(!0),_(J,null,K(S.value,a=>(m(),_("div",{key:a.name,class:"flex items-center justify-between p-2 rounded-lg hover:bg-gray-50 cursor-pointer",onClick:F=>r.$emit("filter","test_logic_type",a.name)},[e("div",Ps,[(m(),L(pe(a.icon),{class:B(["h-5 w-5",a.iconColor])},null,8,["class"])),e("span",js,v(a.name),1)]),o(i(M),{theme:a.theme},{default:b(()=>[T(v(a.count),1)]),_:2},1032,["theme"])],8,qs))),128))])]),e("div",Bs,[l[10]||(l[10]=e("h3",{class:"text-sm font-medium text-gray-700 mb-4"},"Usage Statistics",-1)),e("div",Qs,[e("div",Ms,[l[6]||(l[6]=e("span",{class:"text-sm text-gray-600"},"Total Executions",-1)),e("span",zs,v(z(x.value)),1)]),e("div",Hs,[l[7]||(l[7]=e("span",{class:"text-sm text-gray-600"},"Most Used Test",-1)),e("span",Gs,v(s.value),1)]),e("div",Ws,[l[8]||(l[8]=e("span",{class:"text-sm text-gray-600"},"Avg. Executions/Test",-1)),e("span",Js,v(E.value),1)]),e("div",Ks,[l[9]||(l[9]=e("span",{class:"text-sm text-gray-600"},"Under Review",-1)),o(i(M),{theme:"orange"},{default:b(()=>[T(v(D.value),1)]),_:1})])])])])]))}},Xs=Oe("testLibrary",()=>{const k=q([]),u=q(!1),f=q(!1),A=q(""),g=q(""),S=q(""),V=q(""),y=G({url:"mkaguzi.api.test_library.get_tests",params:()=>({filters:{category:g.value,test_type:S.value,status:V.value},search:A.value}),auto:!1,onSuccess(p){k.value=p||[]}}),x=w(()=>{let p=[...k.value];if(A.value){const c=A.value.toLowerCase();p=p.filter(h=>{var Z,Q,ee,te;return((Z=h.test_name)==null?void 0:Z.toLowerCase().includes(c))||((Q=h.description)==null?void 0:Q.toLowerCase().includes(c))||((ee=h.objective)==null?void 0:ee.toLowerCase().includes(c))||((te=h.test_category)==null?void 0:te.toLowerCase().includes(c))})}return g.value&&(p=p.filter(c=>c.test_category===g.value)),S.value&&(p=p.filter(c=>c.test_logic_type===S.value)),V.value&&(p=p.filter(c=>c.status===V.value)),p}),s=w(()=>{const p={};return x.value.forEach(c=>{const h=c.test_category||"Uncategorized";p[h]||(p[h]=[]),p[h].push(c)}),Object.keys(p).map(c=>({name:c,tests:p[c]})).sort((c,h)=>c.name.localeCompare(h.name))}),E=w(()=>{const p={total:k.value.length,active:0,substantive:0,controls:0,analytical:0};return k.value.forEach(c=>{c.status==="Active"&&p.active++;const h=c.test_logic_type;h==="SQL Query"?p.substantive++:h==="Python Script"?p.controls++:h==="Built-in Function"&&p.analytical++}),p}),D=()=>U(void 0,null,function*(){u.value=!0;try{yield y.reload()}catch(p){console.error("Error fetching tests:",p)}finally{u.value=!1}});return{tests:k,loading:u,saving:f,searchQuery:A,selectedCategory:g,selectedTestType:S,selectedStatus:V,filteredTests:x,groupedTests:s,stats:E,fetchTests:D,createTest:p=>U(void 0,null,function*(){f.value=!0;try{const c=yield G({url:"mkaguzi.api.test_library.create_test",method:"POST",params:p}).submit();return yield D(),c}catch(c){throw console.error("Error creating test:",c),c}finally{f.value=!1}}),updateTest:(p,c)=>U(void 0,null,function*(){f.value=!0;try{const h=yield G({url:"mkaguzi.api.test_library.update_test",method:"PUT",params:ce({name:p},c)}).submit();return yield D(),h}catch(h){throw console.error("Error updating test:",h),h}finally{f.value=!1}}),deleteTest:p=>U(void 0,null,function*(){try{yield G({url:"mkaguzi.api.test_library.delete_test",method:"DELETE",params:{name:p}}).submit(),yield D()}catch(c){throw console.error("Error deleting test:",c),c}}),executeTest:(h,...Z)=>U(void 0,[h,...Z],function*(p,c={}){try{return yield G({url:"mkaguzi.api.test_library.execute_test",method:"POST",params:{test_name:p,parameters:c}}).submit()}catch(Q){throw console.error("Error executing test:",Q),Q}}),getTestDetails:p=>U(void 0,null,function*(){try{return yield G({url:"mkaguzi.api.test_library.get_test_details",params:{name:p}}).submit()}catch(c){throw console.error("Error fetching test details:",c),c}}),getTestHistory:p=>U(void 0,null,function*(){try{return yield G({url:"mkaguzi.api.test_library.get_test_history",params:{test_name:p}}).submit()}catch(c){throw console.error("Error fetching test history:",c),c}}),importTests:p=>U(void 0,null,function*(){try{const c=new FormData;c.append("file",p);const h=yield G({url:"mkaguzi.api.test_library.import_tests",method:"POST",params:c}).submit();return yield D(),h}catch(c){throw console.error("Error importing tests:",c),c}}),exportTests:(...c)=>U(void 0,[...c],function*(p={}){try{return yield G({url:"mkaguzi.api.test_library.export_tests",params:p}).submit()}catch(h){throw console.error("Error exporting tests:",h),h}}),resetFilters:()=>{A.value="",g.value="",S.value="",V.value=""}}}),Zs={class:"p-6"},el={class:"flex justify-between items-center mb-6"},tl={class:"flex gap-2"},sl={class:"bg-white rounded-lg border shadow-sm"},ll={key:0,class:"divide-y divide-gray-200"},al={class:"flex items-center justify-between mb-4"},ol={class:"text-lg font-semibold text-gray-900 flex items-center gap-2"},il={class:"space-y-3"},nl=["onClick"],rl={class:"flex items-start justify-between"},dl={class:"flex-1 min-w-0"},ul={class:"flex items-center gap-3 mb-2"},cl={class:"font-medium text-gray-900"},pl={class:"text-sm text-gray-600 mb-2 line-clamp-2"},ml={class:"flex items-center gap-6 text-sm text-gray-500"},gl={class:"flex items-center gap-1"},vl={class:"flex items-center gap-1"},yl={class:"flex items-center gap-1"},bl={class:"flex items-center gap-3 ml-4"},fl={class:"text-right text-sm"},xl={class:"text-gray-900 font-medium"},hl={key:0,class:"mt-3 pt-3 border-t border-gray-100"},_l={class:"flex items-center gap-2 mb-2"},wl={class:"text-sm font-medium text-gray-700"},Cl={class:"grid grid-cols-1 md:grid-cols-3 gap-2 text-xs text-gray-600"},Tl={class:"w-4 h-4 bg-blue-100 text-blue-800 rounded-full flex items-center justify-center text-xs"},kl={class:"truncate"},$l={key:0,class:"flex items-center gap-1 text-gray-500"},Vl={key:1,class:"mt-3 pt-3 border-t border-gray-100"},Sl={class:"flex items-center justify-between mb-2"},Al={class:"flex items-center gap-2"},El={class:"flex items-center gap-4"},Dl={class:"text-xs text-gray-600"},Fl={key:1,class:"p-12 text-center text-gray-500"},Ul={class:"text-gray-600 mb-6"},Rl={__name:"TestLibrary",setup(k){const u=Xs(),f=w(()=>u.loading);w(()=>u.saving);const A=w({get:()=>u.searchQuery,set:n=>u.searchQuery=n}),g=w({get:()=>u.selectedCategory,set:n=>u.selectedCategory=n}),S=w({get:()=>u.selectedTestType,set:n=>u.selectedTestType=n}),V=w({get:()=>u.selectedStatus,set:n=>u.selectedStatus=n}),y=q([]),x=q(!1),s=q(!1),E=q(null),D=q(""),z=w(()=>u.filteredTests),r=w(()=>u.groupedTests);w(()=>u.stats);const l=()=>U(this,null,function*(){yield u.fetchTests()}),a=()=>U(this,null,function*(){yield u.fetchTests()}),F=()=>{E.value=null,s.value=!1,x.value=!0},j=()=>U(this,null,function*(){x.value=!1,yield u.fetchTests()}),I=()=>{console.log("Import tests")},H=n=>U(this,null,function*(){try{E.value=yield u.getTestDetails(n),s.value=!0,x.value=!0}catch(t){console.error("Error fetching test details:",t)}}),O=n=>{console.log("View test history:",n)},p=n=>{const t=y.value.indexOf(n);t>-1?y.value.splice(t,1):y.value.push(n)},c=n=>[{label:"Execute Test",value:"execute",handler:()=>h(n)},{label:"Edit Test",value:"edit",handler:()=>Z(n)},{label:"Clone Test",value:"clone",handler:()=>Q(n)},{label:"Export",value:"export",handler:()=>ee(n)},{label:"Archive",value:"archive",handler:()=>te(n)}],h=n=>{console.log("Execute test:",n.name)},Z=n=>U(this,null,function*(){try{E.value=yield u.getTestDetails(n.name),s.value=!0,x.value=!0}catch(t){console.error("Error fetching test details:",t)}}),Q=n=>{console.log("Clone test:",n.name)},ee=n=>{console.log("Export test:",n.name)},te=n=>{console.log("Archive test:",n.name)},ge=n=>({"SQL Query":"blue","Python Script":"green","Built-in Function":"purple"})[n]||"gray",de=n=>({Active:"green",Draft:"gray","Under Review":"blue",Archived:"red"})[n]||"gray",ue=n=>({Pass:"bg-green-500",Fail:"bg-red-500",Inconclusive:"bg-yellow-500","N/A":"bg-gray-500"})[n]||"bg-gray-500",ve=(n,t)=>{n==="status"?V.value=t:(n==="test_type"||n==="test_logic_type")&&(S.value=t),D.value=t};return Fe(()=>U(this,null,function*(){yield l()})),(n,t)=>(m(),_("div",Zs,[e("div",el,[t[6]||(t[6]=e("div",null,[e("h1",{class:"text-2xl font-bold"},"Test Library"),e("p",{class:"text-gray-600"},"Manage standardized audit tests and procedures")],-1)),e("div",tl,[o(i(R),{onClick:a,loading:f.value,variant:"outline",size:"sm"},{default:b(()=>[o(i($e),{class:"w-4 h-4"})]),_:1},8,["loading"]),o(i(R),{onClick:I,variant:"outline",size:"sm"},{default:b(()=>[o(i(Ze),{class:"w-4 h-4"})]),_:1}),o(i(R),{onClick:F},{default:b(()=>[o(i(be),{class:"w-4 h-4 mr-2"}),t[5]||(t[5]=T(" New Test ",-1))]),_:1})])]),o(gt,{searchQuery:A.value,"onUpdate:searchQuery":t[0]||(t[0]=$=>A.value=$),selectedCategory:g.value,"onUpdate:selectedCategory":t[1]||(t[1]=$=>g.value=$),selectedTestType:S.value,"onUpdate:selectedTestType":t[2]||(t[2]=$=>S.value=$),selectedStatus:V.value,"onUpdate:selectedStatus":t[3]||(t[3]=$=>V.value=$),onRefresh:a,onCreate:F},null,8,["searchQuery","selectedCategory","selectedTestType","selectedStatus"]),o(Ys,{tests:z.value,"active-filter":D.value,onFilter:ve},null,8,["tests","active-filter"]),e("div",sl,[z.value.length>0?(m(),_("div",ll,[(m(!0),_(J,null,K(r.value,$=>(m(),_("div",{key:$.name,class:"p-4"},[e("div",al,[e("h3",ol,[o(i(et),{class:"w-5 h-5"}),e("span",null,v($.name),1),o(i(M),{variant:"gray",size:"sm"},{default:b(()=>[T(v($.tests.length),1)]),_:2},1024)]),o(i(R),{onClick:C=>p($.name),variant:"ghost",size:"sm"},{default:b(()=>[y.value.includes($.name)?(m(),L(i(tt),{key:0,class:"w-4 h-4"})):(m(),L(i(Se),{key:1,class:"w-4 h-4"}))]),_:2},1032,["onClick"])]),W(e("div",il,[(m(!0),_(J,null,K($.tests,C=>{var oe,d;return m(),_("div",{key:C.name,class:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition-colors",onClick:N=>H(C.name)},[e("div",rl,[e("div",dl,[e("div",ul,[e("h4",cl,v(C.test_name),1),o(i(M),{variant:ge(C.test_logic_type)},{default:b(()=>[T(v(C.test_logic_type),1)]),_:2},1032,["variant"]),o(i(M),{variant:de(C.status),size:"sm"},{default:b(()=>[T(v(C.status),1)]),_:2},1032,["variant"])]),e("p",pl,v(C.description),1),e("div",ml,[e("div",gl,[o(i(me),{class:"w-4 h-4"}),e("span",null,v(C.objective||"No objective"),1)]),e("div",vl,[o(i(re),{class:"w-4 h-4"}),e("span",null,v(C.data_source||"No data source"),1)]),e("div",yl,[o(i(st),{class:"w-4 h-4"}),e("span",null,v(C.estimated_time||0)+" mins",1)])])]),e("div",bl,[e("div",fl,[e("p",xl,v(C.usage_count||0),1),t[7]||(t[7]=e("p",{class:"text-gray-500"},"executions",-1))]),o(i(Ne),{options:c(C)},{default:b(({open:N})=>[o(i(R),{variant:"ghost",size:"sm"},{default:b(()=>[o(i(lt),{class:"w-4 h-4"})]),_:1})]),_:1},8,["options"])])]),(oe=C.test_steps)!=null&&oe.length?(m(),_("div",hl,[e("div",_l,[o(i(at),{class:"w-4 h-4 text-gray-400"}),e("span",wl,"Test Steps ("+v(C.test_steps.length)+")",1)]),e("div",Cl,[(m(!0),_(J,null,K(C.test_steps.slice(0,3),(N,ye)=>(m(),_("div",{key:ye,class:"flex items-center gap-1"},[e("span",Tl,v(ye+1),1),e("span",kl,v(N.description||N.step_description),1)]))),128)),C.test_steps.length>3?(m(),_("div",$l,[e("span",null,"+"+v(C.test_steps.length-3)+" more steps",1)])):P("",!0)])])):P("",!0),(d=C.recent_executions)!=null&&d.length?(m(),_("div",Vl,[e("div",Sl,[e("div",Al,[o(i(Ve),{class:"w-4 h-4 text-gray-400"}),t[8]||(t[8]=e("span",{class:"text-sm font-medium text-gray-700"},"Recent Executions",-1))]),o(i(R),{variant:"ghost",size:"sm",onClick:Ue(N=>O(C.name),["stop"])},{default:b(()=>[...t[9]||(t[9]=[T(" View All ",-1)])]),_:1},8,["onClick"])]),e("div",El,[(m(!0),_(J,null,K(C.recent_executions.slice(0,3),N=>(m(),_("div",{key:N.name,class:"flex items-center gap-2"},[e("div",{class:B(["w-3 h-3 rounded-full",ue(N.result)])},null,2),e("span",Dl,v(n.formatDate(N.execution_date)),1)]))),128))])])):P("",!0)],8,nl)}),128))],512),[[X,y.value.includes($.name)]])]))),128))])):(m(),_("div",Fl,[o(i(re),{class:"w-12 h-12 mx-auto mb-4 text-gray-300"}),t[11]||(t[11]=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No tests found",-1)),e("p",Ul,v(A.value||g.value||S.value?"Try adjusting your filters":"Create your first audit test to get started"),1),o(i(R),{onClick:F},{default:b(()=>[o(i(be),{class:"w-4 h-4 mr-2"}),t[10]||(t[10]=T(" Create Test ",-1))]),_:1})]))]),o(ds,{show:x.value,"onUpdate:show":t[4]||(t[4]=$=>x.value=$),"test-data":E.value,"is-edit-mode":s.value,onSaved:j},null,8,["show","test-data","is-edit-mode"])]))}},jl=Ie(Rl,[["__scopeId","data-v-e3f9acf4"]]);export{jl as default};
//# sourceMappingURL=TestLibrary-tpqS9x5y.js.map
