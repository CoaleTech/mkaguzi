var j=Object.defineProperty;var C=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var L=(m,n,d)=>n in m?j(m,n,{enumerable:!0,configurable:!0,writable:!0,value:d}):m[n]=d,D=(m,n)=>{for(var d in n||(n={}))z.call(n,d)&&L(m,d,n[d]);if(C)for(var d of C(n))F.call(n,d)&&L(m,d,n[d]);return m};var v=(m,n,d)=>new Promise((g,b)=>{var k=p=>{try{f(d.next(p))}catch(r){b(r)}},w=p=>{try{f(d.throw(p))}catch(r){b(r)}},f=p=>p.done?g(p.value):Promise.resolve(p.value).then(k,w);f((d=d.apply(m,n)).next())});import{g as y,a as V,b as u}from"./index-qIC3Tfxg.js";import{ap as W,ab as G,r as c,j as J,Q as K,l as E,p as O,q as l,s as i,u as _,v as o,A as U,z as x,H as X}from"./vue-DciwFjI_.js";import{aL as Y,ad as R}from"./icons-CtLkBOsu.js";import"./charts-DlPBe6v3.js";import"./utils-Bcd7wHeW.js";const Z={class:"p-6"},h={class:"flex items-center justify-between mb-6"},ee={class:"flex items-center gap-4"},le={class:"text-2xl font-bold text-gray-900"},te={class:"text-gray-500 mt-1"},se={class:"flex items-center gap-2"},ae={class:"max-w-4xl"},oe={class:"space-y-6"},ie={class:"bg-white rounded-lg border p-6"},ne={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},de={class:"bg-white rounded-lg border p-6"},ue={class:"space-y-4"},re={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},me={class:"bg-white rounded-lg border p-6"},pe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ve={key:0,class:"bg-white rounded-lg border p-6"},ye={class:"space-y-4"},be={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ce={class:"bg-white rounded-lg border p-6"},ge={class:"flex items-center justify-end gap-3 mt-6 pt-6 border-t"},Ue={__name:"IssueLogForm",setup(m){const n=W(),d=G(),g=c(!1),b=c([]),k=c([]),w=c([]),f=c([]),p=c([]),r=J(()=>n.params.id&&n.params.id!=="new"),s=c({issue_type:"",severity:"Medium",priority:"Medium",status:"Open",reported_by:"",assigned_to:"",reported_date:new Date().toISOString().split("T")[0],due_date:"",description:"",location:"",item_code:"",quantity_affected:0,stock_take_session:"",variance_case:"",audit_plan:"",resolution:"",resolved_by:"",resolved_date:"",notes:""});K(()=>v(this,null,function*(){yield Promise.all([P(),A(),M(),q(),$()]),r.value&&(yield B()),!r.value&&!s.value.reported_by&&(s.value.reported_by=frappe.session.user)}));function P(){return v(this,null,function*(){try{const t=yield y("frappe.client.get_list",{doctype:"User",filters:{enabled:1,user_type:"System User"},fields:["name","full_name"],limit_page_length:0});b.value=t.map(e=>({label:e.full_name||e.name,value:e.name}))}catch(t){console.error("Error loading users:",t)}})}function A(){return v(this,null,function*(){try{const t=yield y("frappe.client.get_list",{doctype:"Item",fields:["name","item_name"],limit_page_length:0});k.value=t.map(e=>({label:`${e.name} - ${e.item_name}`,value:e.name}))}catch(t){console.error("Error loading items:",t)}})}function M(){return v(this,null,function*(){try{const t=yield y("frappe.client.get_list",{doctype:"Stock Take Session",fields:["name","title"],limit_page_length:0});w.value=t.map(e=>({label:e.title||e.name,value:e.name}))}catch(t){console.error("Error loading sessions:",t)}})}function q(){return v(this,null,function*(){try{const t=yield y("frappe.client.get_list",{doctype:"Variance Case",fields:["name","title"],limit_page_length:0});f.value=t.map(e=>({label:e.title||e.name,value:e.name}))}catch(t){console.error("Error loading variance cases:",t)}})}function $(){return v(this,null,function*(){try{const t=yield y("frappe.client.get_list",{doctype:"Audit Plan",fields:["name","title"],limit_page_length:0});p.value=t.map(e=>({label:e.title||e.name,value:e.name}))}catch(t){console.error("Error loading audit plans:",t)}})}function B(){return v(this,null,function*(){try{const t=yield y("frappe.client.get",{doctype:"Issue Log",name:n.params.id});s.value={issue_type:t.issue_type||"",severity:t.severity||"Medium",priority:t.priority||"Medium",status:t.status||"Open",reported_by:t.reported_by||"",assigned_to:t.assigned_to||"",reported_date:t.reported_date||"",due_date:t.due_date||"",description:t.description||"",location:t.location||"",item_code:t.item_code||"",quantity_affected:t.quantity_affected||0,stock_take_session:t.stock_take_session||"",variance_case:t.variance_case||"",audit_plan:t.audit_plan||"",resolution:t.resolution||"",resolved_by:t.resolved_by||"",resolved_date:t.resolved_date||"",notes:t.notes||""}}catch(t){console.error("Error loading issue:",t)}})}function S(){return v(this,null,function*(){if(!s.value.issue_type){alert("Issue type is required");return}if(!s.value.description){alert("Description is required");return}g.value=!0;try{if(r.value)yield y("frappe.client.set_value",{doctype:"Issue Log",name:n.params.id,fieldname:s.value}),d.push(`/inventory-audit/issues/${n.params.id}`);else{const t=yield y("frappe.client.insert",{doc:D({doctype:"Issue Log"},s.value)});d.push(`/inventory-audit/issues/${t.name}`)}}catch(t){console.error("Error saving issue:",t),alert("Error saving issue: "+t.message)}finally{g.value=!1}})}function I(){r.value?d.push(`/inventory-audit/issues/${n.params.id}`):d.push("/inventory-audit/issues")}const T=[{label:"Stock Discrepancy",value:"Stock Discrepancy"},{label:"Quality Issue",value:"Quality Issue"},{label:"Documentation Error",value:"Documentation Error"},{label:"Process Violation",value:"Process Violation"},{label:"System Error",value:"System Error"},{label:"Other",value:"Other"}],N=[{label:"Low",value:"Low"},{label:"Medium",value:"Medium"},{label:"High",value:"High"},{label:"Critical",value:"Critical"}],H=[{label:"Low",value:"Low"},{label:"Medium",value:"Medium"},{label:"High",value:"High"},{label:"Urgent",value:"Urgent"}],Q=[{label:"Open",value:"Open"},{label:"In Progress",value:"In Progress"},{label:"Resolved",value:"Resolved"},{label:"Closed",value:"Closed"}];return(t,e)=>(O(),E("div",Z,[l("div",h,[l("div",ee,[i(o(V),{variant:"ghost",onClick:I},{default:_(()=>[i(o(Y),{class:"w-5 h-5"})]),_:1}),l("div",null,[l("h1",le,U(r.value?"Edit Issue":"Log New Issue"),1),l("p",te,U(r.value?`Editing ${o(n).params.id}`:"Report a new stock take issue"),1)])]),l("div",se,[i(o(V),{variant:"outline",onClick:I},{default:_(()=>[...e[19]||(e[19]=[x("Cancel",-1)])]),_:1}),i(o(V),{variant:"solid",onClick:S,loading:g.value},{default:_(()=>[i(o(R),{class:"w-4 h-4 mr-2"}),x(" "+U(r.value?"Save Changes":"Log Issue"),1)]),_:1},8,["loading"])])]),l("div",ae,[l("div",oe,[l("div",ie,[e[28]||(e[28]=l("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Basic Information",-1)),l("div",ne,[l("div",null,[e[20]||(e[20]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[x(" Issue Type "),l("span",{class:"text-red-500"},"*")],-1)),i(o(u),{type:"select",modelValue:s.value.issue_type,"onUpdate:modelValue":e[0]||(e[0]=a=>s.value.issue_type=a),options:T},null,8,["modelValue"])]),l("div",null,[e[21]||(e[21]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Severity",-1)),i(o(u),{type:"select",modelValue:s.value.severity,"onUpdate:modelValue":e[1]||(e[1]=a=>s.value.severity=a),options:N},null,8,["modelValue"])]),l("div",null,[e[22]||(e[22]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Priority",-1)),i(o(u),{type:"select",modelValue:s.value.priority,"onUpdate:modelValue":e[2]||(e[2]=a=>s.value.priority=a),options:H},null,8,["modelValue"])]),l("div",null,[e[23]||(e[23]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Status",-1)),i(o(u),{type:"select",modelValue:s.value.status,"onUpdate:modelValue":e[3]||(e[3]=a=>s.value.status=a),options:Q},null,8,["modelValue"])]),l("div",null,[e[24]||(e[24]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Reported By",-1)),i(o(u),{type:"autocomplete",modelValue:s.value.reported_by,"onUpdate:modelValue":e[4]||(e[4]=a=>s.value.reported_by=a),options:b.value,placeholder:"Select user"},null,8,["modelValue","options"])]),l("div",null,[e[25]||(e[25]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Assigned To",-1)),i(o(u),{type:"autocomplete",modelValue:s.value.assigned_to,"onUpdate:modelValue":e[5]||(e[5]=a=>s.value.assigned_to=a),options:b.value,placeholder:"Select assignee"},null,8,["modelValue","options"])]),l("div",null,[e[26]||(e[26]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Reported Date",-1)),i(o(u),{type:"date",modelValue:s.value.reported_date,"onUpdate:modelValue":e[6]||(e[6]=a=>s.value.reported_date=a)},null,8,["modelValue"])]),l("div",null,[e[27]||(e[27]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Due Date",-1)),i(o(u),{type:"date",modelValue:s.value.due_date,"onUpdate:modelValue":e[7]||(e[7]=a=>s.value.due_date=a)},null,8,["modelValue"])])])]),l("div",de,[e[33]||(e[33]=l("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Issue Details",-1)),l("div",ue,[l("div",null,[e[29]||(e[29]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[x(" Description "),l("span",{class:"text-red-500"},"*")],-1)),i(o(u),{type:"textarea",modelValue:s.value.description,"onUpdate:modelValue":e[8]||(e[8]=a=>s.value.description=a),placeholder:"Describe the issue in detail...",rows:4},null,8,["modelValue"])]),l("div",null,[e[30]||(e[30]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Location",-1)),i(o(u),{type:"text",modelValue:s.value.location,"onUpdate:modelValue":e[9]||(e[9]=a=>s.value.location=a),placeholder:"Where did this issue occur?"},null,8,["modelValue"])]),l("div",re,[l("div",null,[e[31]||(e[31]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Item Code",-1)),i(o(u),{type:"autocomplete",modelValue:s.value.item_code,"onUpdate:modelValue":e[10]||(e[10]=a=>s.value.item_code=a),options:k.value,placeholder:"Select affected item"},null,8,["modelValue","options"])]),l("div",null,[e[32]||(e[32]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Quantity Affected",-1)),i(o(u),{type:"number",modelValue:s.value.quantity_affected,"onUpdate:modelValue":e[11]||(e[11]=a=>s.value.quantity_affected=a),placeholder:"0"},null,8,["modelValue"])])])])]),l("div",me,[e[37]||(e[37]=l("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Related Records",-1)),l("div",pe,[l("div",null,[e[34]||(e[34]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Stock Take Session",-1)),i(o(u),{type:"autocomplete",modelValue:s.value.stock_take_session,"onUpdate:modelValue":e[12]||(e[12]=a=>s.value.stock_take_session=a),options:w.value,placeholder:"Link to session"},null,8,["modelValue","options"])]),l("div",null,[e[35]||(e[35]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Variance Case",-1)),i(o(u),{type:"autocomplete",modelValue:s.value.variance_case,"onUpdate:modelValue":e[13]||(e[13]=a=>s.value.variance_case=a),options:f.value,placeholder:"Link to variance case"},null,8,["modelValue","options"])]),l("div",null,[e[36]||(e[36]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Audit Plan",-1)),i(o(u),{type:"autocomplete",modelValue:s.value.audit_plan,"onUpdate:modelValue":e[14]||(e[14]=a=>s.value.audit_plan=a),options:p.value,placeholder:"Link to audit plan"},null,8,["modelValue","options"])])])]),s.value.status==="Resolved"?(O(),E("div",ve,[e[41]||(e[41]=l("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Resolution Details",-1)),l("div",ye,[l("div",null,[e[38]||(e[38]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Resolution",-1)),i(o(u),{type:"textarea",modelValue:s.value.resolution,"onUpdate:modelValue":e[15]||(e[15]=a=>s.value.resolution=a),placeholder:"Describe how this issue was resolved...",rows:3},null,8,["modelValue"])]),l("div",be,[l("div",null,[e[39]||(e[39]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Resolved By",-1)),i(o(u),{type:"autocomplete",modelValue:s.value.resolved_by,"onUpdate:modelValue":e[16]||(e[16]=a=>s.value.resolved_by=a),options:b.value,placeholder:"Select user"},null,8,["modelValue","options"])]),l("div",null,[e[40]||(e[40]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Resolved Date",-1)),i(o(u),{type:"date",modelValue:s.value.resolved_date,"onUpdate:modelValue":e[17]||(e[17]=a=>s.value.resolved_date=a)},null,8,["modelValue"])])])])])):X("",!0),l("div",ce,[e[42]||(e[42]=l("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Additional Notes",-1)),i(o(u),{type:"textarea",modelValue:s.value.notes,"onUpdate:modelValue":e[18]||(e[18]=a=>s.value.notes=a),placeholder:"Any additional notes or observations...",rows:3},null,8,["modelValue"])])]),l("div",ge,[i(o(V),{variant:"outline",onClick:I},{default:_(()=>[...e[43]||(e[43]=[x("Cancel",-1)])]),_:1}),i(o(V),{variant:"solid",onClick:S,loading:g.value},{default:_(()=>[i(o(R),{class:"w-4 h-4 mr-2"}),x(" "+U(r.value?"Save Changes":"Log Issue"),1)]),_:1},8,["loading"])])])]))}};export{Ue as default};
//# sourceMappingURL=IssueLogForm-CcKNyJGm.js.map
