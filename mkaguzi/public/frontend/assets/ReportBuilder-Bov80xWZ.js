var V=(U,r,b)=>new Promise((p,y)=>{var f=v=>{try{h(b.next(v))}catch(C){y(C)}},j=v=>{try{h(b.throw(v))}catch(C){y(C)}},h=v=>v.done?p(v.value):Promise.resolve(v.value).then(f,j);h((b=b.apply(U,r)).next())});import{r as x,Q as te,l as d,p as u,q as l,H as R,s as a,z as i,v as s,u as m,A as g,F as D,x as k,a6 as M}from"./vue-DciwFjI_.js";import{_ as le,a as _,b as w,c as S}from"./index-qIC3Tfxg.js";import{ba as T,ad as $,a9 as L,a0 as ae,D as E,K as se,a4 as P,at as O,$ as oe}from"./icons-CtLkBOsu.js";import"./charts-DlPBe6v3.js";import"./utils-Bcd7wHeW.js";const ne={class:"p-6 max-w-7xl mx-auto"},ie={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 gap-4"},re={class:"text-3xl font-bold text-gray-900 flex items-center gap-3"},de={class:"flex flex-wrap gap-3"},ue={class:"grid grid-cols-1 lg:grid-cols-4 gap-6 mb-6"},ce={class:"lg:col-span-1"},pe={class:"bg-white rounded-lg border shadow-sm p-4 h-fit"},me={class:"font-semibold mb-4 flex items-center gap-2"},fe={class:"space-y-4"},ve={key:0,class:"space-y-3"},ge={class:"font-medium text-sm text-gray-700 flex items-center justify-between"},ye={class:"space-y-2 max-h-80 overflow-y-auto border rounded-md p-2 bg-gray-50"},be=["onDragstart"],he={class:"flex items-center gap-2 flex-1 min-w-0"},xe={class:"text-sm truncate"},_e={class:"lg:col-span-3"},we={class:"bg-white rounded-lg border shadow-sm p-6"},De={class:"flex justify-between items-center mb-6"},ke={class:"font-semibold flex items-center gap-2"},Ce={class:"flex gap-2"},Re={class:"space-y-6"},Se={class:"flex items-center justify-between mb-4"},Ve={class:"font-medium flex items-center gap-2 text-gray-700"},Te={class:"flex flex-wrap gap-2 min-h-16"},Ee={class:"text-sm font-medium"},je={key:0,class:"flex items-center justify-center w-full min-h-16 text-gray-500 text-sm"},Ae={class:"text-center"},Fe={class:"flex items-center justify-between mb-4"},Le={class:"font-medium flex items-center gap-2 text-gray-700"},Oe={class:"space-y-3 min-h-16"},Ue={class:"flex-1 min-w-0"},ze={class:"text-sm font-medium block"},Ie={key:0,class:"flex items-center justify-center w-full min-h-16 text-gray-500 text-sm"},Be={class:"text-center"},Me={class:"bg-white rounded-lg border shadow-sm p-6 mb-6"},$e={class:"font-semibold mb-6 flex items-center gap-2"},Pe={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},Ne={class:"mt-6"},qe={key:0,class:"bg-white rounded-lg border shadow-sm p-6"},Je={class:"flex justify-between items-center mb-6"},He={class:"font-semibold flex items-center gap-2"},Ke={class:"flex gap-2"},Qe={class:"overflow-x-auto border rounded-lg"},Xe={class:"min-w-full divide-y divide-gray-200"},Ge={class:"bg-gray-50"},We={class:"flex items-center gap-2"},Ye={class:"bg-white divide-y divide-gray-200"},Ze={key:0,class:"text-center py-4 text-gray-500 bg-gray-50 border-t"},et={class:"flex items-center justify-center gap-2"},tt={__name:"ReportBuilder",setup(U){const r=x({doctype:"",title:"",type:"Custom Report",chartType:"Table Only",description:""}),b=x([]),p=x([]),y=x([]),f=x([]),j=x(!1),h=x(!1),v=x(!1),C=[{label:"Audit Engagement",value:"Audit Engagement"},{label:"Audit Finding",value:"Audit Finding"},{label:"Corrective Action",value:"Corrective Action"},{label:"Compliance Requirement",value:"Compliance Requirement"},{label:"Risk Assessment",value:"Risk Assessment"},{label:"Test Execution",value:"Test Execution"}],N=[{label:"Custom Report",value:"Custom Report"},{label:"Summary Report",value:"Summary Report"},{label:"Detailed Report",value:"Detailed Report"},{label:"Compliance Report",value:"Compliance Report"}],q=[{label:"Table Only",value:"Table Only"},{label:"Bar Chart",value:"Bar Chart"},{label:"Line Chart",value:"Line Chart"},{label:"Pie Chart",value:"Pie Chart"},{label:"Doughnut Chart",value:"Doughnut Chart"}],J=[{label:"=",value:"="},{label:"!=",value:"!="},{label:">",value:">"},{label:"<",value:"<"},{label:">=",value:">="},{label:"<=",value:"<="},{label:"Like",value:"like"},{label:"In",value:"in"},{label:"Not In",value:"not in"}],H=()=>V(this,null,function*(){if(r.value.doctype)try{const o={"Audit Engagement":[{fieldname:"name",label:"ID",fieldtype:"Data"},{fieldname:"engagement_title",label:"Title",fieldtype:"Data"},{fieldname:"audit_type",label:"Audit Type",fieldtype:"Select"},{fieldname:"start_date",label:"Start Date",fieldtype:"Date"},{fieldname:"end_date",label:"End Date",fieldtype:"Date"},{fieldname:"status",label:"Status",fieldtype:"Select"},{fieldname:"risk_rating",label:"Risk Rating",fieldtype:"Select"},{fieldname:"assigned_auditor",label:"Assigned Auditor",fieldtype:"Link"}],"Audit Finding":[{fieldname:"name",label:"ID",fieldtype:"Data"},{fieldname:"finding_title",label:"Title",fieldtype:"Data"},{fieldname:"finding_type",label:"Type",fieldtype:"Select"},{fieldname:"severity",label:"Severity",fieldtype:"Select"},{fieldname:"status",label:"Status",fieldtype:"Select"},{fieldname:"engagement_reference",label:"Engagement",fieldtype:"Link"},{fieldname:"finding_date",label:"Date",fieldtype:"Date"}],"Corrective Action":[{fieldname:"name",label:"ID",fieldtype:"Data"},{fieldname:"action_title",label:"Title",fieldtype:"Data"},{fieldname:"status",label:"Status",fieldtype:"Select"},{fieldname:"priority",label:"Priority",fieldtype:"Select"},{fieldname:"due_date",label:"Due Date",fieldtype:"Date"},{fieldname:"assigned_to",label:"Assigned To",fieldtype:"Link"},{fieldname:"finding_reference",label:"Finding",fieldtype:"Link"}]};b.value=o[r.value.doctype]||[]}catch(o){console.error("Error loading fields:",o)}}),K=(o,e)=>{o.dataTransfer.setData("application/json",JSON.stringify(e))},z=(o,e)=>{o.preventDefault();try{const t=JSON.parse(o.dataTransfer.getData("application/json"));e==="columns"?p.value.find(n=>n.fieldname===t.fieldname)||p.value.push(t):e==="filters"&&(y.value.find(n=>n.field.fieldname===t.fieldname)||y.value.push({field:t,operator:"=",value:""}))}catch(t){console.error("Error handling drop:",t)}},I=(o,e)=>{o==="columns"?p.value.splice(e,1):o==="filters"&&y.value.splice(e,1)},Q=()=>{p.value=[],y.value=[],f.value=[]},A=()=>V(this,null,function*(){if(p.value.length===0){alert("Please select at least one column for your report");return}try{h.value=!0;const o=G();f.value=o}catch(o){console.error("Error generating preview:",o)}finally{h.value=!1}}),X=()=>{A()},G=()=>{const o=[],e=Math.floor(Math.random()*50)+10;for(let t=0;t<e;t++){const n={};p.value.forEach(c=>{if(c.fieldtype==="Date"){const F=new Date;F.setDate(F.getDate()-Math.floor(Math.random()*365)),n[c.fieldname]=F.toISOString().split("T")[0]}else c.fieldtype==="Int"?n[c.fieldname]=Math.floor(Math.random()*1e3):n[c.fieldname]=`Sample ${c.label} ${t+1}`}),o.push(n)}return o},W=()=>{if(!r.value.title){alert("Please enter a report title");return}console.log("Saving report:",r.value),alert("Report saved successfully!")},Y=()=>V(this,null,function*(){try{v.value=!0,f.value.length===0&&(yield A());const o=Z(),e=new Blob([o],{type:"text/csv"}),t=window.URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download=`${r.value.title||"report"}.csv`,n.click(),window.URL.revokeObjectURL(t)}catch(o){console.error("Error exporting report:",o)}finally{v.value=!1}}),Z=()=>{const o=p.value.map(t=>t.label).join(","),e=f.value.map(t=>p.value.map(n=>B(t[n.fieldname],n)).join(","));return[o,...e].join(`
`)},ee=o=>({Data:"secondary",Date:"info",Int:"warning",Select:"success",Link:"primary",Text:"secondary","Text Editor":"secondary",Check:"success"})[o]||"secondary",B=(o,e)=>o?e.fieldtype==="Date"&&o?new Date(o).toLocaleDateString():String(o):"";return te(()=>{}),(o,e)=>(u(),d("div",ne,[l("div",ie,[l("div",null,[l("h1",re,[a(s(T),{class:"w-8 h-8 text-blue-600"}),e[9]||(e[9]=i(" Report Builder ",-1))]),e[10]||(e[10]=l("p",{class:"text-gray-600 mt-2 text-lg"},"Create custom reports with drag-and-drop functionality",-1))]),l("div",de,[a(s(_),{onClick:W,loading:j.value,variant:"outline",class:"flex items-center gap-2"},{default:m(()=>[a(s($),{class:"w-4 h-4"}),e[11]||(e[11]=i(" Save Report ",-1))]),_:1},8,["loading"]),a(s(_),{onClick:A,loading:h.value,class:"flex items-center gap-2"},{default:m(()=>[a(s(L),{class:"w-4 h-4"}),e[12]||(e[12]=i(" Preview ",-1))]),_:1},8,["loading"]),a(s(_),{onClick:Y,loading:v.value,variant:"outline",class:"flex items-center gap-2"},{default:m(()=>[a(s(ae),{class:"w-4 h-4"}),e[13]||(e[13]=i(" Export ",-1))]),_:1},8,["loading"])])]),l("div",ue,[l("div",ce,[l("div",pe,[l("h3",me,[a(s(E),{class:"w-5 h-5 text-blue-600"}),e[14]||(e[14]=i(" Data Source ",-1))]),l("div",fe,[a(s(w),{label:"Select DocType",modelValue:r.value.doctype,"onUpdate:modelValue":e[0]||(e[0]=t=>r.value.doctype=t),type:"select",options:C,onChange:H,required:""},null,8,["modelValue"]),r.value.doctype?(u(),d("div",ve,[l("h4",ge,[e[15]||(e[15]=i(" Available Fields ",-1)),a(s(S),{variant:"secondary",size:"sm"},{default:m(()=>[i(g(b.value.length),1)]),_:1})]),l("div",ye,[(u(!0),d(D,null,k(b.value,t=>(u(),d("div",{key:t.fieldname,class:"flex items-center justify-between gap-2 p-2 border rounded cursor-pointer hover:bg-white hover:shadow-sm transition-all duration-200",onDragstart:n=>K(n,t),draggable:"true"},[l("div",he,[a(s(E),{class:"w-4 h-4 text-gray-500 flex-shrink-0"}),l("span",xe,g(t.label),1)]),a(s(S),{variant:ee(t.fieldtype),size:"sm",class:"flex-shrink-0"},{default:m(()=>[i(g(t.fieldtype),1)]),_:2},1032,["variant"])],40,be))),128))])])):R("",!0)])])]),l("div",_e,[l("div",we,[l("div",De,[l("h3",ke,[a(s(T),{class:"w-5 h-5 text-green-600"}),e[16]||(e[16]=i(" Report Canvas ",-1))]),l("div",Ce,[a(s(_),{onClick:Q,variant:"outline",size:"sm",class:"flex items-center gap-2"},{default:m(()=>[a(s(se),{class:"w-4 h-4"}),e[17]||(e[17]=i(" Clear ",-1))]),_:1})])]),l("div",Re,[l("div",{class:"border-2 border-dashed border-gray-300 rounded-lg p-6 min-h-32 transition-all duration-200 hover:border-blue-400 hover:bg-blue-50/50",onDragover:e[1]||(e[1]=M(()=>{},["prevent"])),onDrop:e[2]||(e[2]=t=>z(t,"columns"))},[l("div",Se,[l("h4",Ve,[a(s(T),{class:"w-4 h-4 text-blue-600"}),e[18]||(e[18]=i(" Columns ",-1))]),a(s(S),{variant:"secondary",size:"sm"},{default:m(()=>[i(g(p.value.length),1)]),_:1})]),l("div",Te,[(u(!0),d(D,null,k(p.value,(t,n)=>(u(),d("div",{key:t.fieldname,class:"flex items-center gap-2 bg-blue-50 border border-blue-200 rounded-lg px-3 py-2 hover:bg-blue-100 transition-colors duration-200"},[a(s(E),{class:"w-3 h-3 text-blue-600 flex-shrink-0"}),l("span",Ee,g(t.label),1),a(s(_),{onClick:c=>I("columns",n),variant:"ghost",size:"sm",class:"p-0 h-5 w-5 hover:bg-blue-200"},{default:m(()=>[a(s(P),{class:"w-3 h-3"})]),_:1},8,["onClick"])]))),128)),p.value.length===0?(u(),d("div",je,[l("div",Ae,[a(s(T),{class:"w-8 h-8 mx-auto mb-2 opacity-50"}),e[19]||(e[19]=i(" Drag fields here to add columns to your report ",-1))])])):R("",!0)])],32),l("div",{class:"border-2 border-dashed border-gray-300 rounded-lg p-6 min-h-32 transition-all duration-200 hover:border-green-400 hover:bg-green-50/50",onDragover:e[3]||(e[3]=M(()=>{},["prevent"])),onDrop:e[4]||(e[4]=t=>z(t,"filters"))},[l("div",Fe,[l("h4",Le,[a(s(O),{class:"w-4 h-4 text-green-600"}),e[20]||(e[20]=i(" Filters ",-1))]),a(s(S),{variant:"secondary",size:"sm"},{default:m(()=>[i(g(y.value.length),1)]),_:1})]),l("div",Oe,[(u(!0),d(D,null,k(y.value,(t,n)=>(u(),d("div",{key:t.field.fieldname,class:"flex items-center gap-3 bg-green-50 border border-green-200 rounded-lg p-3 hover:bg-green-100 transition-colors duration-200"},[a(s(O),{class:"w-4 h-4 text-green-600 flex-shrink-0"}),l("div",Ue,[l("span",ze,g(t.field.label),1)]),a(s(w),{modelValue:t.operator,"onUpdate:modelValue":c=>t.operator=c,type:"select",options:J,class:"w-20 flex-shrink-0",size:"sm"},null,8,["modelValue","onUpdate:modelValue"]),a(s(w),{modelValue:t.value,"onUpdate:modelValue":c=>t.value=c,type:o.getFilterInputType(t.field),placeholder:"Value",class:"flex-1 min-w-32",size:"sm"},null,8,["modelValue","onUpdate:modelValue","type"]),a(s(_),{onClick:c=>I("filters",n),variant:"ghost",size:"sm",class:"p-0 h-6 w-6 hover:bg-green-200 flex-shrink-0"},{default:m(()=>[a(s(P),{class:"w-4 h-4"})]),_:1},8,["onClick"])]))),128)),y.value.length===0?(u(),d("div",Ie,[l("div",Be,[a(s(O),{class:"w-8 h-8 mx-auto mb-2 opacity-50"}),e[21]||(e[21]=i(" Drag fields here to add filters to your report ",-1))])])):R("",!0)])],32)])])])]),l("div",Me,[l("h3",$e,[a(s($),{class:"w-5 h-5 text-purple-600"}),e[22]||(e[22]=i(" Report Settings ",-1))]),l("div",Pe,[a(s(w),{label:"Report Title",modelValue:r.value.title,"onUpdate:modelValue":e[5]||(e[5]=t=>r.value.title=t),type:"text",placeholder:"Enter report title",required:""},null,8,["modelValue"]),a(s(w),{label:"Report Type",modelValue:r.value.type,"onUpdate:modelValue":e[6]||(e[6]=t=>r.value.type=t),type:"select",options:N},null,8,["modelValue"]),a(s(w),{label:"Chart Type",modelValue:r.value.chartType,"onUpdate:modelValue":e[7]||(e[7]=t=>r.value.chartType=t),type:"select",options:q},null,8,["modelValue"])]),l("div",Ne,[a(s(w),{label:"Description",modelValue:r.value.description,"onUpdate:modelValue":e[8]||(e[8]=t=>r.value.description=t),type:"textarea",placeholder:"Optional description",rows:"3"},null,8,["modelValue"])])]),f.value.length>0?(u(),d("div",qe,[l("div",Je,[l("h3",He,[a(s(L),{class:"w-5 h-5 text-indigo-600"}),e[23]||(e[23]=i(" Report Preview ",-1)),a(s(S),{variant:"secondary",size:"sm"},{default:m(()=>[i(g(f.value.length)+" rows",1)]),_:1})]),l("div",Ke,[a(s(_),{onClick:X,loading:h.value,variant:"outline",size:"sm",class:"flex items-center gap-2"},{default:m(()=>[a(s(oe),{class:"w-4 h-4"}),e[24]||(e[24]=i(" Refresh ",-1))]),_:1},8,["loading"])])]),l("div",Qe,[l("table",Xe,[l("thead",Ge,[l("tr",null,[(u(!0),d(D,null,k(p.value,t=>(u(),d("th",{key:t.fieldname,class:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider border-b"},[l("div",We,[a(s(E),{class:"w-4 h-4 text-gray-500"}),i(" "+g(t.label),1)])]))),128))])]),l("tbody",Ye,[(u(!0),d(D,null,k(f.value.slice(0,10),(t,n)=>(u(),d("tr",{key:t.name||t.id||n,class:"hover:bg-gray-50 transition-colors duration-150"},[(u(!0),d(D,null,k(p.value,c=>(u(),d("td",{key:c.fieldname,class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},g(B(t[c.fieldname],c)),1))),128))]))),128))])]),f.value.length>10?(u(),d("div",Ze,[l("div",et,[a(s(L),{class:"w-4 h-4"}),i(" Showing first 10 rows of "+g(f.value.length)+" total rows ",1)])])):R("",!0)])])):R("",!0)]))}},rt=le(tt,[["__scopeId","data-v-ade6d71c"]]);export{rt as default};
//# sourceMappingURL=ReportBuilder-Bov80xWZ.js.map
